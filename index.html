<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµæ¢å®šä»·åˆ†æå·¥å…·</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --border: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* å¤´éƒ¨ */
        .header {
            background: white;
            border-radius: 16px;
            padding: 24px 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
        }
        
        .logo-area {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 8px;
        }
        
        .logo {
            font-size: 32px;
            color: var(--primary);
        }
        
        .title {
            color: var(--dark);
            font-size: 24px;
            font-weight: 700;
        }
        
        .subtitle {
            color: #64748b;
            font-size: 14px;
        }
        
        /* SKUç®¡ç† - ç°åœ¨æ”¾åœ¨ç¬¬ä¸€ä½ */
        .sku-management {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }
        
        .sku-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .sku-controls {
            display: flex;
            gap: 12px;
        }
        
        .sku-table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .sku-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1300px;
        }
        
        .sku-table th {
            background: #f1f5f9;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            font-size: 13px;
            border-bottom: 1px solid var(--border);
        }
        
        .sku-table td {
            padding: 10px 16px;
            border-bottom: 1px solid var(--border);
            color: #475569;
            font-size: 13px;
        }
        
        .sku-table tr:hover {
            background: #f8fafc;
        }
        
        .sku-table input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .sku-table input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }
        
        .sku-table input:focus + .enter-hint {
            opacity: 1;
        }
        
        .sku-actions {
            display: flex;
            gap: 6px;
        }
        
        .sku-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .sku-btn.add {
            background: var(--primary);
            color: white;
        }
        
        .sku-btn.remove {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .sku-btn.calc {
            background: var(--success);
            color: white;
        }
        
        /* æŠ˜æ‰£ç±»å‹åˆ‡æ¢ */
        .discount-type {
            display: flex;
            background: #e2e8f0;
            border-radius: 6px;
            padding: 4px;
            margin-bottom: 8px;
        }
        
        .type-btn {
            flex: 1;
            padding: 4px 6px;
            text-align: center;
            font-size: 11px;
            font-weight: 500;
            color: #64748b;
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .type-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* æŠ˜æ‰£é‡‘é¢é¢„è§ˆ */
        .discount-preview {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .discount-preview-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
        }
        
        .discount-preview-label {
            color: #64748b;
        }
        
        .discount-preview-value {
            font-weight: 600;
        }
        
        .discount-preview-value.primary {
            color: var(--primary);
        }
        
        .discount-preview-value.warning {
            color: var(--warning);
        }
        
        .discount-preview-value.danger {
            color: var(--danger);
        }
        
        .discount-preview-total {
            border-top: 1px solid var(--border);
            padding-top: 4px;
            margin-top: 2px;
            font-weight: 600;
            font-size: 12px;
            color: var(--dark);
        }
        
        /* æˆæœ¬å‚æ•°é¢æ¿ - ç°åœ¨æ”¾åœ¨ç¬¬äºŒä½ */
        .cost-panel {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }
        
        .section-title {
            color: var(--dark);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            color: #475569;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .input-wrapper {
            position: relative;
        }
        
        .input-wrapper input {
            width: 100%;
            padding: 10px 36px 10px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            background: white;
        }
        
        .input-wrapper input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .currency {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-weight: 500;
        }
        
        .input-tip {
            color: #94a3b8;
            font-size: 12px;
            margin-top: 6px;
        }
        
        /* æˆæœ¬å‚æ•°é‡‘é¢é¢„è§ˆ */
        .cost-preview {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            margin-top: 20px;
        }
        
        .cost-preview-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cost-preview-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        @media (max-width: 768px) {
            .cost-preview-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .cost-preview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .cost-preview-label {
            font-size: 14px;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cost-preview-value {
            font-size: 16px;
            font-weight: 600;
        }
        
        .cost-preview-value.platform {
            color: #3b82f6;
        }
        
        .cost-preview-value.kol {
            color: #8b5cf6;
        }
        
        .cost-preview-value.return {
            color: #f59e0b;
        }
        
        .cost-preview-value.other {
            color: #10b981;
        }
        
        .cost-preview-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            margin-top: 12px;
            background: #f1f5f9;
            border-radius: 8px;
            border: 2px solid var(--primary);
        }
        
        .cost-preview-total-label {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .cost-preview-total-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }
        
        /* å‚æ•°ç½‘æ ¼ */
        .params-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }
        
        @media (max-width: 1200px) {
            .params-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .params-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* æ–°å¢ï¼šåå‘è®¡ç®—é¢æ¿ï¼ˆæ ¹æ®æœ€ç»ˆå”®ä»·åæ¨ç›®æ ‡å”®ä»·ï¼‰ */
        .reverse-calculation-panel {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }
        
        .reverse-calc-form {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1200px) {
            .reverse-calc-form {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .reverse-calc-form {
                grid-template-columns: 1fr;
            }
        }
        
        .reverse-result {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--primary);
            margin-top: 20px;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        
        .result-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .result-label {
            font-size: 14px;
            color: #64748b;
        }
        
        .result-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .result-note {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 8px;
            font-style: italic;
        }
        
        /* ç»„åˆä¿ƒé”€é¢æ¿ */
        .combo-pricing-panel {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
        }
        
        .combo-settings {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1200px) {
            .combo-settings {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .combo-settings {
                grid-template-columns: 1fr;
            }
        }
        
        .combo-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .combo-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .combo-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .combo-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .combo-badge {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .combo-price {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }
        
        .combo-unit-price {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 8px;
        }
        
        .combo-discount {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed var(--border);
        }
        
        .discount-label {
            font-size: 12px;
            color: #64748b;
        }
        
        .discount-value {
            font-size: 14px;
            font-weight: 600;
        }
        
        .discount-value.primary {
            color: var(--primary);
        }
        
        .discount-value.success {
            color: var(--success);
        }
        
        .discount-value.danger {
            color: var(--danger);
        }
        
        /* ç»„åˆä¿ƒé”€è¡¨æ ¼ */
        .combo-table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .combo-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1100px;
        }
        
        .combo-table th {
            background: #f1f5f9;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            font-size: 13px;
            border-bottom: 1px solid var(--border);
        }
        
        .combo-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            color: #475569;
            font-size: 13px;
        }
        
        .combo-table tr:hover {
            background: #f8fafc;
        }
        
        .combo-table input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .combo-table input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }
        
        .combo-sku-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .combo-sku-select {
            padding: 8px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            min-width: 200px;
            background: white;
        }
        
        /* æŒ‰é’® */
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--light);
            border-color: var(--primary);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #fbbf24 100%);
            color: white;
        }
        
        /* å ä½ç¬¦æ ·å¼ */
        .placeholder {
            color: #94a3b8;
            font-style: italic;
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* é”™è¯¯æç¤º */
        .error-message {
            background: #fef2f2;
            border: 2px solid #fee2e2;
            color: #dc2626;
            padding: 10px 16px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: var(--success);
            color: white;
        }
        
        .notification.error {
            background: #ef4444;
        }
        
        .notification.warning {
            background: #f59e0b;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        /* å›è½¦æç¤º */
        .enter-hint {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        
        .input-with-hint {
            position: relative;
        }
        
        /* è¡¨æ ¼å•å…ƒæ ¼æ ·å¼ */
        .table-cell-input {
            position: relative;
        }
        
        .discount-input-group {
            margin-bottom: 8px;
        }
        
        /* ç©ºçŠ¶æ€æç¤º */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state-text {
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .empty-state-subtext {
            font-size: 12px;
            color: #cbd5e1;
        }
        
        /* ç»„åˆSKUæ“ä½œæŒ‰é’® */
        .combo-sku-actions {
            display: flex;
            gap: 4px;
        }
        
        .combo-sku-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .combo-sku-btn.copy {
            background: var(--primary);
            color: white;
        }
        
        .combo-sku-btn.copy:hover {
            background: var(--primary-light);
        }
        
        .combo-sku-btn.add {
            background: var(--success);
            color: white;
        }
        
        .combo-sku-btn.add:hover {
            background: #34d399;
        }
        
        /* æˆæœ¬é¢„è§ˆå›¾æ ‡ */
        .cost-icon {
            font-size: 16px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }
        
        .platform-icon {
            background: #dbeafe;
            color: #3b82f6;
        }
        
        .kol-icon {
            background: #ede9fe;
            color: #8b5cf6;
        }
        
        .return-icon {
            background: #fef3c7;
            color: #f59e0b;
        }
        
        .other-icon {
            background: #d1fae5;
            color: #10b981;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div class="logo-area">
                <div class="logo">ğŸ’°</div>
                <div>
                    <h1 class="title">çµæ¢å®šä»·åˆ†æå·¥å…·</h1>
                    <p class="subtitle">å¤šSKUæˆæœ¬æ ¸å¯¹ Â· åŒè¡Œå¯¹æ ‡ Â· ç»„åˆä¿ƒé”€å®šä»·</p>
                </div>
            </div>
        </div>
        
        <!-- SKUç®¡ç† - ç°åœ¨æ”¾åœ¨ç¬¬ä¸€ä½ -->
        <div class="sku-management fade-in">
            <div class="sku-header">
                <div class="section-title">ğŸ“¦ SKUå®šä»·ç®¡ç†</div>
                <div class="sku-controls">
                    <button class="btn sku-btn add" id="addSKU">
                        â• æ·»åŠ SKU
                    </button>
                    <button class="btn btn-primary" id="calculateAll">
                        ğŸš€ æ‰¹é‡è®¡ç®—
                    </button>
                </div>
            </div>
            
            <div class="sku-table-container">
                <table class="sku-table">
                    <thead>
                        <tr>
                            <th width="120">SKUåç§°</th>
                            <th width="100">æˆæœ¬ä»·(å…ƒ)</th>
                            <th width="100">ç›®æ ‡å”®ä»·(å…ƒ)</th>
                            <th width="200">å•å“ç›´é™</th>
                            <th width="200">ä¼˜æƒ åˆ¸</th>
                            <th width="100">æœ€ç»ˆå”®ä»·(å…ƒ)</th>
                            <th width="90">æ¯›åˆ©(å…ƒ)</th>
                            <th width="80">æ¯›åˆ©ç‡</th>
                            <th width="80">æˆæœ¬æ¯›åˆ©ç‡</th>
                            <th width="90">å‡€åˆ©(å…ƒ)</th>
                            <th width="80">å‡€åˆ©ç‡</th>
                            <th width="70">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="skuTableBody">
                        <!-- åˆå§‹ä¸ºç©º -->
                    </tbody>
                </table>
                <!-- ç©ºçŠ¶æ€æç¤º -->
                <div id="emptyState" class="empty-state" style="display: block;">
                    <div class="empty-state-icon">ğŸ“¦</div>
                    <div class="empty-state-text">æš‚æ— SKUæ•°æ®</div>
                    <div class="empty-state-subtext">ç‚¹å‡»"æ·»åŠ SKU"æŒ‰é’®å¼€å§‹æ·»åŠ ï¼Œæˆ–ç‚¹å‡»"æ·»åŠ ç¤ºä¾‹"æŸ¥çœ‹ç¤ºä¾‹æ•°æ®</div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 14px; color: #64748b;">
                    æ€»è®¡ <span id="skuCount" style="font-weight: 700; color: var(--primary);">0</span> ä¸ªSKU
                </div>
                <div>
                    <button class="btn btn-secondary" id="addSampleSKUs">
                        ğŸ“‹ æ·»åŠ ç¤ºä¾‹
                    </button>
                    <button class="btn btn-success" id="exportData">
                        ğŸ“¤ å¯¼å‡ºæ•°æ®
                    </button>
                    <button class="btn btn-warning" id="addComboSKUs" style="display: none;">
                        ğŸ“‹ æ·»åŠ ç»„åˆSKU
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æˆæœ¬å‚æ•°é¢æ¿ - ç°åœ¨æ”¾åœ¨ç¬¬äºŒä½ -->
        <div class="cost-panel fade-in">
            <div class="section-title">ğŸ“Š æˆæœ¬å‚æ•°é…ç½®</div>
            <p style="color: #64748b; font-size: 14px; margin-bottom: 16px;">è®¾ç½®å¹³å°ä½£é‡‘ã€è¾¾äººä½£é‡‘ã€é€€è´§ç‡å’Œå…¶ä»–æˆæœ¬ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è®¡ç®—å„é¡¹æˆæœ¬çš„å…·ä½“é‡‘é¢</p>
            
            <div class="params-grid">
                <div class="input-group">
                    <label class="input-label">
                        å¹³å°ä½£é‡‘æ¯”ä¾‹
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="platformFee" value="5" min="0" max="50" step="0.1" placeholder="ä¾‹å¦‚ï¼š5">
                        <span class="currency">%</span>
                    </div>
                    <div class="input-tip">é€šå¸¸5-10%</div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">
                        è¾¾äººä½£é‡‘æ¯”ä¾‹
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="kolFee" value="20" min="0" max="50" step="0.1" placeholder="ä¾‹å¦‚ï¼š20">
                        <span class="currency">%</span>
                    </div>
                    <div class="input-tip">è¾¾äººå¸¦è´§ä½£é‡‘</div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">
                        é€€è´§ç‡é¢„ä¼°
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="returnRate" value="5" min="0" max="50" step="0.1" placeholder="ä¾‹å¦‚ï¼š5">
                        <span class="currency">%</span>
                    </div>
                    <div class="input-tip">è¡Œä¸šå¹³å‡5-15%</div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">
                        å…¶ä»–æˆæœ¬
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="otherCost" value="5" min="0" step="0.01" placeholder="åŒ…è£…ã€è¿è´¹ç­‰">
                        <span class="currency">å…ƒ</span>
                    </div>
                    <div class="input-tip">æ¯ä»¶å•†å“é¢å¤–æˆæœ¬</div>
                </div>
            </div>
            
            <!-- æˆæœ¬é‡‘é¢é¢„è§ˆ -->
            <div class="cost-preview" id="costPreview">
                <div class="cost-preview-title">
                    <span>ğŸ“‹ æˆæœ¬æ˜ç»†ï¼ˆåŸºäºå‚è€ƒå”®ä»·ï¼‰</span>
                </div>
                
                <div class="cost-preview-grid">
                    <div class="cost-preview-item">
                        <div class="cost-preview-label">
                            <div class="cost-icon platform-icon">ğŸ¢</div>
                            <span>å¹³å°ä½£é‡‘</span>
                        </div>
                        <div class="cost-preview-value platform" id="platformCost">0.00 å…ƒ</div>
                    </div>
                    
                    <div class="cost-preview-item">
                        <div class="cost-preview-label">
                            <div class="cost-icon kol-icon">ğŸŒŸ</div>
                            <span>è¾¾äººä½£é‡‘</span>
                        </div>
                        <div class="cost-preview-value kol" id="kolCost">0.00 å…ƒ</div>
                    </div>
                    
                    <div class="cost-preview-item">
                        <div class="cost-preview-label">
                            <div class="cost-icon return-icon">ğŸ“¦</div>
                            <span>é€€è´§æŸè€—</span>
                        </div>
                        <div class="cost-preview-value return" id="returnCost">0.00 å…ƒ</div>
                    </div>
                    
                    <div class="cost-preview-item">
                        <div class="cost-preview-label">
                            <div class="cost-icon other-icon">ğŸ“¦</div>
                            <span>å…¶ä»–æˆæœ¬</span>
                        </div>
                        <div class="cost-preview-value other" id="otherCostAmount">0.00 å…ƒ</div>
                    </div>
                </div>
                
                <div class="cost-preview-total">
                    <div class="cost-preview-total-label">æ¯ä»¶å•†å“æ€»é¢å¤–æˆæœ¬</div>
                    <div class="cost-preview-total-value" id="totalAdditionalCost">0.00 å…ƒ</div>
                </div>
                
                <div style="margin-top: 12px; font-size: 12px; color: #94a3b8;">
                    <div>å‚è€ƒå”®ä»·ï¼š<span id="referencePrice" style="font-weight: 600; color: var(--primary);">0.00 å…ƒ</span></div>
                    <div>è¯´æ˜ï¼šæˆæœ¬æ˜ç»†åŸºäºå‚è€ƒå”®ä»·è®¡ç®—ï¼Œå‚è€ƒå”®ä»·ä¸ºå·²è®¡ç®—SKUçš„å¹³å‡æœ€ç»ˆå”®ä»·</div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="applyToAll">
                    ğŸ”„ åº”ç”¨åˆ°æ‰€æœ‰SKU
                </button>
                <button class="btn btn-secondary" id="resetConfig">
                    ğŸ”„ é‡ç½®é…ç½®
                </button>
                <button class="btn btn-warning" id="updateCostPreview">
                    ğŸ” æ›´æ–°æˆæœ¬é¢„è§ˆ
                </button>
            </div>
        </div>
        
        <!-- æ–°å¢ï¼šåå‘è®¡ç®—é¢æ¿ï¼ˆæ ¹æ®æœ€ç»ˆå”®ä»·åæ¨ç›®æ ‡å”®ä»·ï¼‰ -->
        <div class="reverse-calculation-panel fade-in">
            <div class="section-title">ğŸ”„ åå‘è®¡ç®—ï¼šæ ¹æ®æœ€ç»ˆå”®ä»·åæ¨ç›®æ ‡å”®ä»·</div>
            <p style="color: #64748b; font-size: 14px; margin-bottom: 16px;">é€‰æ‹©ä¸€ä¸ªSKUï¼Œè¾“å…¥æ‚¨æœŸæœ›çš„æœ€ç»ˆå”®ä»·ï¼Œç³»ç»Ÿå°†æ ¹æ®è¯¥SKUçš„å•å“ç›´é™å’Œä¼˜æƒ åˆ¸è®¾ç½®ï¼Œåæ¨å‡ºéœ€è¦çš„ç›®æ ‡å”®ä»·</p>
            
            <div class="reverse-calc-form">
                <div class="input-group">
                    <label class="input-label">é€‰æ‹©SKU</label>
                    <select id="reverseSkuSelect" class="combo-sku-select">
                        <option value="">è¯·é€‰æ‹©SKU</option>
                    </select>
                    <div class="input-tip">é€‰æ‹©è¦åå‘è®¡ç®—çš„SKU</div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">æœŸæœ›æœ€ç»ˆå”®ä»·</label>
                    <div class="input-wrapper">
                        <input type="number" id="reverseFinalPrice" min="0" step="0.01" placeholder="è¾“å…¥æœŸæœ›çš„æœ€ç»ˆå”®ä»·">
                        <span class="currency">å…ƒ</span>
                    </div>
                    <div class="input-tip">æ‚¨å¸Œæœ›å•†å“æœ€ç»ˆé”€å”®çš„ä»·æ ¼</div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">å•å“ç›´é™è®¾ç½®</label>
                    <div class="input-wrapper" style="margin-bottom: 8px;">
                        <div class="discount-type" id="reverseDirectDiscountType">
                            <button class="type-btn active" data-type="percent">ç™¾åˆ†æ¯”(%)</button>
                            <button class="type-btn" data-type="amount">å›ºå®šé‡‘é¢(å…ƒ)</button>
                        </div>
                    </div>
                    <div class="input-wrapper">
                        <input type="number" id="reverseDirectDiscountValue" min="0" step="0.01" placeholder="è¾“å…¥å•å“ç›´é™å€¼">
                        <span class="currency" id="reverseDirectCurrency">%</span>
                    </div>
                    <div class="input-tip">ä¸åŸSKUçš„å•å“ç›´é™è®¾ç½®ä¿æŒä¸€è‡´</div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">ä¼˜æƒ åˆ¸è®¾ç½®</label>
                    <div class="input-wrapper" style="margin-bottom: 8px;">
                        <div class="discount-type" id="reverseCouponDiscountType">
                            <button class="type-btn active" data-type="percent">ç™¾åˆ†æ¯”(%)</button>
                            <button class="type-btn" data-type="amount">å›ºå®šé‡‘é¢(å…ƒ)</button>
                        </div>
                    </div>
                    <div class="input-wrapper">
                        <input type="number" id="reverseCouponDiscountValue" min="0" step="0.01" placeholder="è¾“å…¥ä¼˜æƒ åˆ¸å€¼">
                        <span class="currency" id="reverseCouponCurrency">%</span>
                    </div>
                    <div class="input-tip">ä¸åŸSKUçš„ä¼˜æƒ åˆ¸è®¾ç½®ä¿æŒä¸€è‡´</div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="reverseCalculate">
                    ğŸ” å¼€å§‹åå‘è®¡ç®—
                </button>
                <button class="btn btn-secondary" id="copyToSKU">
                    ğŸ“‹ å¤åˆ¶åˆ°SKUç®¡ç†
                </button>
                <button class="btn btn-warning" id="resetReverseCalc">
                    ğŸ”„ é‡ç½®è®¾ç½®
                </button>
            </div>
            
            <!-- è®¡ç®—ç»“æœåŒºåŸŸ -->
            <div id="reverseResult" class="reverse-result" style="display: none;">
                <h4 style="color: var(--dark); font-size: 16px; margin-bottom: 16px;">åå‘è®¡ç®—ç»“æœ</h4>
                
                <div class="result-row">
                    <div class="result-label">éœ€è¦çš„ç›®æ ‡å”®ä»·ï¼š</div>
                    <div class="result-value" id="reverseTargetPriceResult">0.00 å…ƒ</div>
                </div>
                
                <div class="result-row">
                    <div class="result-label">å•å“ç›´é™é‡‘é¢ï¼š</div>
                    <div class="result-value" id="reverseDirectDiscountAmount">0.00 å…ƒ</div>
                </div>
                
                <div class="result-row">
                    <div class="result-label">ä¼˜æƒ åˆ¸é‡‘é¢ï¼š</div>
                    <div class="result-value" id="reverseCouponAmount">0.00 å…ƒ</div>
                </div>
                
                <div class="result-row">
                    <div class="result-label">éªŒè¯è®¡ç®—ï¼š</div>
                    <div class="result-value" id="reverseVerification">0.00 å…ƒ</div>
                </div>
                
                <div class="result-note">
                    è®¡ç®—å…¬å¼ï¼šç›®æ ‡å”®ä»· - å•å“ç›´é™ - ä¼˜æƒ åˆ¸ = æœ€ç»ˆå”®ä»·<br>
                    éªŒè¯ï¼š<span id="reverseTargetPriceText">0.00</span> - <span id="reverseDirectText">0.00</span> - <span id="reverseCouponText">0.00</span> = <span id="reverseFinalText">0.00</span>
                </div>
            </div>
        </div>
        
        <!-- ç»„åˆä¿ƒé”€å®šä»·åˆ†æ -->
        <div class="combo-pricing-panel fade-in">
            <div class="section-title">ğŸ¯ ç»„åˆä¿ƒé”€å®šä»·åˆ†æ</div>
            <p style="color: #64748b; font-size: 14px; margin-bottom: 16px;">åˆ†æä¸åŒè´­ä¹°æ•°é‡ä¸‹çš„æ¯ç“¶å®é™…ä»·æ ¼å’Œä¼˜æƒ å¹…åº¦ï¼Œæ–¹ä¾¿æ‚¨åˆ¶å®šç»„åˆä¿ƒé”€ç­–ç•¥</p>
            
            <!-- SKUé€‰æ‹©å™¨ -->
            <div class="combo-sku-selector">
                <label for="comboSkuSelect" style="font-size: 14px; color: #475569; font-weight: 500;">é€‰æ‹©SKUè¿›è¡Œåˆ†æï¼š</label>
                <select id="comboSkuSelect" class="combo-sku-select">
                    <option value="">è¯·é€‰æ‹©SKU</option>
                </select>
                <button class="btn btn-primary" id="analyzeCombo">
                    ğŸ” åˆ†æç»„åˆå®šä»·
                </button>
            </div>
            
            <!-- ç»„åˆä¿ƒé”€è®¾ç½® -->
            <div style="margin: 20px 0;">
                <h4 style="color: var(--dark); font-size: 15px; margin-bottom: 12px;">ä¿ƒé”€è®¾ç½®</h4>
                <div class="combo-settings">
                    <div class="combo-card">
                        <div class="combo-card-header">
                            <div class="combo-title">å•ä¹°ä»·æ ¼</div>
                            <div class="combo-badge">1ç“¶</div>
                        </div>
                        <div class="combo-price" id="singlePrice">- å…ƒ</div>
                        <div class="combo-unit-price" id="singleUnitPrice">æ¯ç“¶ï¼š- å…ƒ</div>
                        <div class="combo-discount">
                            <div class="discount-label">ä¼˜æƒ å¹…åº¦</div>
                            <div class="discount-value" id="singleDiscount">-</div>
                        </div>
                    </div>
                    
                    <div class="combo-card">
                        <div class="combo-card-header">
                            <div class="combo-title">2ç“¶ç»„åˆ</div>
                            <div class="combo-badge">2ç“¶</div>
                        </div>
                        <div class="combo-price" id="twoPrice">- å…ƒ</div>
                        <div class="combo-unit-price" id="twoUnitPrice">æ¯ç“¶ï¼š- å…ƒ</div>
                        <div class="combo-discount">
                            <div class="discount-label">æ¯ç“¶èŠ‚çœ</div>
                            <div class="discount-value" id="twoSavePerUnit">-</div>
                        </div>
                        <div class="input-wrapper" style="margin-top: 8px;">
                            <input type="number" id="twoComboDiscount" min="0" step="0.01" placeholder="2ç“¶æ€»ä¼˜æƒ (å…ƒ)">
                            <span class="currency">å…ƒ</span>
                        </div>
                    </div>
                    
                    <div class="combo-card">
                        <div class="combo-card-header">
                            <div class="combo-title">3ç“¶ç»„åˆ</div>
                            <div class="combo-badge">3ç“¶</div>
                        </div>
                        <div class="combo-price" id="threePrice">- å…ƒ</div>
                        <div class="combo-unit-price" id="threeUnitPrice">æ¯ç“¶ï¼š- å…ƒ</div>
                        <div class="combo-discount">
                            <div class="discount-label">æ¯ç“¶èŠ‚çœ</div>
                            <div class="discount-value" id="threeSavePerUnit">-</div>
                        </div>
                        <div class="input-wrapper" style="margin-top: 8px;">
                            <input type="number" id="threeComboDiscount" min="0" step="0.01" placeholder="3ç“¶æ€»ä¼˜æƒ (å…ƒ)">
                            <span class="currency">å…ƒ</span>
                        </div>
                    </div>
                    
                    <div class="combo-card">
                        <div class="combo-card-header">
                            <div class="combo-title">4ç“¶ç»„åˆ</div>
                            <div class="combo-badge">4ç“¶</div>
                        </div>
                        <div class="combo-price" id="fourPrice">- å…ƒ</div>
                        <div class="combo-unit-price" id="fourUnitPrice">æ¯ç“¶ï¼š- å…ƒ</div>
                        <div class="combo-discount">
                            <div class="discount-label">æ¯ç“¶èŠ‚çœ</div>
                            <div class="discount-value" id="fourSavePerUnit">-</div>
                        </div>
                        <div class="input-wrapper" style="margin-top: 8px;">
                            <input type="number" id="fourComboDiscount" min="0" step="0.01" placeholder="4ç“¶æ€»ä¼˜æƒ (å…ƒ)">
                            <span class="currency">å…ƒ</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç»„åˆä¿ƒé”€åˆ†æè¡¨æ ¼ -->
            <div style="margin-top: 24px;">
                <h4 style="color: var(--dark); font-size: 15px; margin-bottom: 12px;">ç»„åˆä¿ƒé”€åˆ†æè¡¨</h4>
                <div class="combo-table-container">
                    <table class="combo-table">
                        <thead>
                            <tr>
                                <th width="120">è´­ä¹°æ•°é‡</th>
                                <th width="120">ç»„åˆä¼˜æƒ (å…ƒ)</th>
                                <th width="120">å®ä»˜æ€»ä»·(å…ƒ)</th>
                                <th width="120">æ¯ç“¶ä»·æ ¼(å…ƒ)</th>
                                <th width="120">æ¯ç“¶èŠ‚çœ(å…ƒ)</th>
                                <th width="120">æŠ˜æ‰£å¹…åº¦</th>
                                <th width="120">åˆ©æ¶¦åˆ†æ</th>
                                <th width="160">ç»„åˆSKUæœ€ç»ˆå”®ä»·<br><span style="font-size: 11px; color: #64748b;">(å®ä»˜æ€»ä»·)</span></th>
                                <th width="160">ç»„åˆSKUç›®æ ‡å”®ä»·<br><span style="font-size: 11px; color: #64748b;">(æ ¹æ®å•å“æŠ˜æ‰£åæ¨)</span></th>
                                <th width="100">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="comboTableBody">
                            <tr>
                                <td colspan="10" class="placeholder" style="text-align: center;">è¯·é€‰æ‹©SKUå¹¶è®¾ç½®ç»„åˆä¼˜æƒ </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button class="btn btn-secondary" id="clearCombo">
                    ğŸ—‘ï¸ æ¸…ç©ºç»„åˆè®¾ç½®
                </button>
                <button class="btn btn-primary" id="saveCombo">
                    ğŸ’¾ ä¿å­˜ç»„åˆæ–¹æ¡ˆ
                </button>
                <button class="btn btn-success" id="exportCombo">
                    ğŸ“¤ å¯¼å‡ºç»„åˆåˆ†æ
                </button>
                <button class="btn btn-warning" id="copyAllToSKU">
                    ğŸ“‹ å¤åˆ¶æ‰€æœ‰åˆ°SKUç®¡ç†
                </button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let skuList = [];
        let inputTimeout = null; // é˜²æŠ–è®¡æ—¶å™¨
        let selectedComboSku = null; // é€‰ä¸­çš„ç»„åˆä¿ƒé”€SKU
        let comboData = {}; // å­˜å‚¨ç»„åˆä¿ƒé”€æ•°æ®
        let reverseCalcSku = null; // åå‘è®¡ç®—é€‰ä¸­çš„SKU
        let reverseDirectDiscountType = 'percent'; // åå‘è®¡ç®—å•å“ç›´é™ç±»å‹
        let reverseCouponDiscountType = 'percent'; // åå‘è®¡ç®—ä¼˜æƒ åˆ¸ç±»å‹
        let referencePrice = 0; // å‚è€ƒå”®ä»·ï¼Œç”¨äºæˆæœ¬é¢„è§ˆ
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            // æ·»åŠ ä¸€ä¸ªç©ºçš„SKUï¼Œè®©ç”¨æˆ·å¯ä»¥ç«‹å³å¼€å§‹å¡«å†™
            addEmptySKU();
            
            // åˆå§‹åŒ–åå‘è®¡ç®—æŠ˜æ‰£ç±»å‹åˆ‡æ¢
            initReverseDiscountType();
            
            // åˆå§‹åŒ–æˆæœ¬å‚æ•°é¢„è§ˆ
            updateCostPreview();
        });
        
        // åˆå§‹åŒ–åå‘è®¡ç®—æŠ˜æ‰£ç±»å‹åˆ‡æ¢
        function initReverseDiscountType() {
            // å•å“ç›´é™ç±»å‹åˆ‡æ¢
            document.querySelectorAll('#reverseDirectDiscountType .type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    reverseDirectDiscountType = type;
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('#reverseDirectDiscountType .type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ›´æ–°è´§å¸ç¬¦å·
                    document.getElementById('reverseDirectCurrency').textContent = type === 'percent' ? '%' : 'å…ƒ';
                });
            });
            
            // ä¼˜æƒ åˆ¸ç±»å‹åˆ‡æ¢
            document.querySelectorAll('#reverseCouponDiscountType .type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    reverseCouponDiscountType = type;
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('#reverseCouponDiscountType .type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ›´æ–°è´§å¸ç¬¦å·
                    document.getElementById('reverseCouponCurrency').textContent = type === 'percent' ? '%' : 'å…ƒ';
                });
            });
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æˆæœ¬å‚æ•°è¾“å…¥äº‹ä»¶ - ä½¿ç”¨é˜²æŠ–
            const costInputIds = ['platformFee', 'kolFee', 'returnRate', 'otherCost'];
            costInputIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', debounce(updateCostPreview, 500));
                }
            });
            
            // ç»„åˆä¿ƒé”€è¾“å…¥äº‹ä»¶
            const comboInputIds = ['twoComboDiscount', 'threeComboDiscount', 'fourComboDiscount'];
            comboInputIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        if (selectedComboSku) {
                            calculateComboPricing();
                        }
                    });
                }
            });
            
            // æŒ‰é’®äº‹ä»¶
            document.getElementById('applyToAll').addEventListener('click', applyToAllSKUs);
            document.getElementById('resetConfig').addEventListener('click', resetConfig);
            document.getElementById('updateCostPreview').addEventListener('click', updateCostPreview);
            document.getElementById('addSKU').addEventListener('click', addSKU);
            document.getElementById('addSampleSKUs').addEventListener('click', addSampleSKUs);
            document.getElementById('calculateAll').addEventListener('click', calculateAllSKUs);
            document.getElementById('exportData').addEventListener('click', exportSKUData);
            document.getElementById('addComboSKUs').addEventListener('click', addAllComboSKUsToManagement);
            
            // ç»„åˆä¿ƒé”€ç›¸å…³æŒ‰é’®
            document.getElementById('analyzeCombo').addEventListener('click', analyzeComboPricing);
            document.getElementById('clearCombo').addEventListener('click', clearComboSettings);
            document.getElementById('saveCombo').addEventListener('click', saveComboScheme);
            document.getElementById('exportCombo').addEventListener('click', exportComboAnalysis);
            document.getElementById('copyAllToSKU').addEventListener('click', copyAllComboSKUsToManagement);
            
            // åå‘è®¡ç®—ç›¸å…³æŒ‰é’®
            document.getElementById('reverseCalculate').addEventListener('click', calculateReversePrice);
            document.getElementById('copyToSKU').addEventListener('click', copyReverseResultToSKU);
            document.getElementById('resetReverseCalc').addEventListener('click', resetReverseCalculation);
            
            // SKUé€‰æ‹©å™¨å˜åŒ–äº‹ä»¶
            document.getElementById('comboSkuSelect').addEventListener('change', function() {
                const skuId = parseInt(this.value);
                if (skuId) {
                    selectedComboSku = skuList.find(sku => sku.id === skuId);
                    if (selectedComboSku) {
                        // å¦‚æœæœ‰ä¿å­˜çš„ç»„åˆæ•°æ®ï¼ŒåŠ è½½å®ƒ
                        if (comboData[skuId]) {
                            loadComboSettings(skuId);
                        } else {
                            // å¦åˆ™ä½¿ç”¨é»˜è®¤è®¾ç½®
                            resetComboSettings();
                        }
                        calculateComboPricing();
                    }
                }
            });
            
            // åå‘è®¡ç®—SKUé€‰æ‹©å™¨å˜åŒ–äº‹ä»¶
            document.getElementById('reverseSkuSelect').addEventListener('change', function() {
                const skuId = parseInt(this.value);
                if (skuId) {
                    reverseCalcSku = skuList.find(sku => sku.id === skuId);
                    if (reverseCalcSku) {
                        // è‡ªåŠ¨å¡«å……æŠ˜æ‰£è®¾ç½®
                        loadReverseDiscountSettings();
                    }
                }
            });
        }
        
        // åŠ è½½åå‘è®¡ç®—æŠ˜æ‰£è®¾ç½®
        function loadReverseDiscountSettings() {
            if (!reverseCalcSku) return;
            
            // è®¾ç½®å•å“ç›´é™
            reverseDirectDiscountType = reverseCalcSku.directDiscountType;
            document.querySelectorAll('#reverseDirectDiscountType .type-btn').forEach(btn => {
                if (btn.getAttribute('data-type') === reverseDirectDiscountType) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            document.getElementById('reverseDirectDiscountValue').value = reverseCalcSku.directDiscountValue || 0;
            document.getElementById('reverseDirectCurrency').textContent = reverseDirectDiscountType === 'percent' ? '%' : 'å…ƒ';
            
            // è®¾ç½®ä¼˜æƒ åˆ¸
            reverseCouponDiscountType = reverseCalcSku.couponDiscountType;
            document.querySelectorAll('#reverseCouponDiscountType .type-btn').forEach(btn => {
                if (btn.getAttribute('data-type') === reverseCouponDiscountType) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            document.getElementById('reverseCouponDiscountValue').value = reverseCalcSku.couponDiscountValue || 0;
            document.getElementById('reverseCouponCurrency').textContent = reverseCouponDiscountType === 'percent' ? '%' : 'å…ƒ';
            
            // å¦‚æœSKUæœ‰æœ€ç»ˆå”®ä»·ï¼Œè‡ªåŠ¨å¡«å……
            if (reverseCalcSku.finalPrice > 0) {
                document.getElementById('reverseFinalPrice').value = reverseCalcSku.finalPrice;
            }
        }
        
        // é˜²æŠ–å‡½æ•°
        function debounce(func, delay) {
            return function() {
                clearTimeout(inputTimeout);
                const context = this;
                const args = arguments;
                inputTimeout = setTimeout(() => func.apply(context, args), delay);
            };
        }
        
        // æ›´æ–°æˆæœ¬é¢„è§ˆ
        function updateCostPreview() {
            // è·å–æˆæœ¬å‚æ•°
            const platformFeePercent = parseFloat(document.getElementById('platformFee').value) / 100 || 0;
            const kolFeePercent = parseFloat(document.getElementById('kolFee').value) / 100 || 0;
            const returnRatePercent = parseFloat(document.getElementById('returnRate').value) / 100 || 0;
            const otherCost = parseFloat(document.getElementById('otherCost').value) || 0;
            
            // è®¡ç®—å‚è€ƒå”®ä»·ï¼ˆä½¿ç”¨å·²è®¡ç®—SKUçš„å¹³å‡æœ€ç»ˆå”®ä»·ï¼‰
            let totalFinalPrice = 0;
            let calculatedSKUCount = 0;
            
            skuList.forEach(sku => {
                if (sku.finalPrice > 0) {
                    totalFinalPrice += sku.finalPrice;
                    calculatedSKUCount++;
                }
            });
            
            if (calculatedSKUCount > 0) {
                referencePrice = totalFinalPrice / calculatedSKUCount;
            } else {
                // å¦‚æœæ²¡æœ‰å·²è®¡ç®—çš„SKUï¼Œä½¿ç”¨é»˜è®¤å‚è€ƒå”®ä»·
                referencePrice = 100; // é»˜è®¤100å…ƒä½œä¸ºå‚è€ƒ
            }
            
            // æ›´æ–°å‚è€ƒå”®ä»·æ˜¾ç¤º
            document.getElementById('referencePrice').textContent = referencePrice.toFixed(2) + ' å…ƒ';
            
            // è®¡ç®—å„é¡¹æˆæœ¬é‡‘é¢
            const platformCost = referencePrice * platformFeePercent;
            const kolCost = referencePrice * kolFeePercent;
            const returnCost = referencePrice * returnRatePercent;
            const otherCostAmount = otherCost;
            const totalAdditionalCost = platformCost + kolCost + returnCost + otherCostAmount;
            
            // æ›´æ–°æˆæœ¬é‡‘é¢æ˜¾ç¤º
            document.getElementById('platformCost').textContent = platformCost.toFixed(2) + ' å…ƒ';
            document.getElementById('kolCost').textContent = kolCost.toFixed(2) + ' å…ƒ';
            document.getElementById('returnCost').textContent = returnCost.toFixed(2) + ' å…ƒ';
            document.getElementById('otherCostAmount').textContent = otherCostAmount.toFixed(2) + ' å…ƒ';
            document.getElementById('totalAdditionalCost').textContent = totalAdditionalCost.toFixed(2) + ' å…ƒ';
            
            // æ›´æ–°æ‰€æœ‰SKUçš„è®¡ç®—ï¼ˆå¦‚æœæˆæœ¬å‚æ•°å˜åŒ–ï¼‰
            if (calculatedSKUCount > 0) {
                calculateAllSKUs();
            }
        }
        
        // æ·»åŠ ä¸€ä¸ªç©ºçš„SKU
        function addEmptySKU() {
            const newId = skuList.length > 0 ? Math.max(...skuList.map(sku => sku.id)) + 1 : 1;
            skuList.push({
                id: newId,
                name: `SKU-${String(newId).padStart(3, '0')}`,
                cost: 0,
                targetPrice: 0,
                directDiscountType: 'percent',
                directDiscountValue: 0,
                couponDiscountType: 'percent',
                couponDiscountValue: 0,
                directDiscount: 0,
                couponAmount: 0,
                finalPrice: 0,
                grossProfit: 0,
                grossMargin: 0,
                costMargin: 0,
                netProfit: 0,
                netMargin: 0,
                // æ–°å¢å­—æ®µï¼šæŠ˜æ‰£é¢„è§ˆ
                directDiscountPreview: 0,
                couponDiscountPreview: 0,
                priceAfterDirect: 0,
                priceAfterAll: 0,
                // ç»„åˆä¿ƒé”€å­—æ®µ
                comboDiscounts: {
                    two: 0,
                    three: 0,
                    four: 0
                },
                // æ–°å¢å­—æ®µï¼šç»„åˆç›®æ ‡å”®ä»·ï¼ˆå•å“ç›®æ ‡å”®ä»·ï¼‰
                comboTargetPrices: {
                    one: 0,
                    two: 0,
                    three: 0,
                    four: 0
                }
            });
            
            updateSKUTable();
            updateSkuSelector();
            updateReverseSkuSelector();
            // éšè—ç©ºçŠ¶æ€æç¤º
            document.getElementById('emptyState').style.display = 'none';
        }
        
        // æ›´æ–°SKUé€‰æ‹©å™¨ï¼ˆç»„åˆä¿ƒé”€ï¼‰
        function updateSkuSelector() {
            const select = document.getElementById('comboSkuSelect');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©SKU</option>';
            
            skuList.forEach(sku => {
                const option = document.createElement('option');
                option.value = sku.id;
                option.textContent = `${sku.name} (æˆæœ¬: Â¥${sku.cost.toFixed(2)}, å”®ä»·: Â¥${sku.finalPrice > 0 ? sku.finalPrice.toFixed(2) : 'æœªè®¡ç®—'})`;
                select.appendChild(option);
            });
        }
        
        // æ›´æ–°åå‘è®¡ç®—SKUé€‰æ‹©å™¨
        function updateReverseSkuSelector() {
            const select = document.getElementById('reverseSkuSelect');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©SKU</option>';
            
            skuList.forEach(sku => {
                const option = document.createElement('option');
                option.value = sku.id;
                option.textContent = `${sku.name} (æˆæœ¬: Â¥${sku.cost.toFixed(2)}, æœ€ç»ˆå”®ä»·: Â¥${sku.finalPrice > 0 ? sku.finalPrice.toFixed(2) : 'æœªè®¡ç®—'})`;
                select.appendChild(option);
            });
        }
        
        // æ·»åŠ ç¤ºä¾‹SKUæ•°æ®
        function addSampleSKUs() {
            const sampleSKUs = [
                { id: 1, name: 'åŸºç¡€æ¬¾', cost: 85, targetPrice: 199, directDiscountType: 'percent', directDiscountValue: 10, couponDiscountType: 'percent', couponDiscountValue: 5 },
                { id: 2, name: 'å‡çº§æ¬¾', cost: 120, targetPrice: 299, directDiscountType: 'percent', directDiscountValue: 15, couponDiscountType: 'percent', couponDiscountValue: 8 },
                { id: 3, name: 'æ——èˆ°æ¬¾', cost: 200, targetPrice: 499, directDiscountType: 'amount', directDiscountValue: 50, couponDiscountType: 'percent', couponDiscountValue: 10 }
            ];
            
            // å¦‚æœå½“å‰æ²¡æœ‰SKUï¼Œæ¸…ç©ºç°æœ‰SKU
            if (skuList.length === 0) {
                skuList = [];
            }
            
            // è·å–æ–°çš„èµ·å§‹ID
            const startId = skuList.length > 0 ? Math.max(...skuList.map(sku => sku.id)) + 1 : 1;
            
            sampleSKUs.forEach((sku, index) => {
                skuList.push({
                    id: startId + index,
                    name: sku.name,
                    cost: sku.cost,
                    targetPrice: sku.targetPrice,
                    directDiscountType: sku.directDiscountType,
                    directDiscountValue: sku.directDiscountValue,
                    couponDiscountType: sku.couponDiscountType,
                    couponDiscountValue: sku.couponDiscountValue,
                    directDiscount: 0,
                    couponAmount: 0,
                    finalPrice: 0,
                    grossProfit: 0,
                    grossMargin: 0,
                    costMargin: 0,
                    netProfit: 0,
                    netMargin: 0,
                    // æ–°å¢å­—æ®µï¼šæŠ˜æ‰£é¢„è§ˆ
                    directDiscountPreview: 0,
                    couponDiscountPreview: 0,
                    priceAfterDirect: 0,
                    priceAfterAll: 0,
                    // ç»„åˆä¿ƒé”€å­—æ®µ
                    comboDiscounts: {
                        two: 10,
                        three: 25,
                        four: 40
                    },
                    // æ–°å¢å­—æ®µï¼šç»„åˆç›®æ ‡å”®ä»·
                    comboTargetPrices: {
                        one: 0,
                        two: 0,
                        three: 0,
                        four: 0
                    }
                });
            });
            
            updateSKUTable();
            updateSkuSelector();
            updateReverseSkuSelector();
            // éšè—ç©ºçŠ¶æ€æç¤º
            document.getElementById('emptyState').style.display = 'none';
            showNotification('å·²æ·»åŠ 3ä¸ªç¤ºä¾‹SKUæ•°æ®ï¼Œè¯·ç‚¹å‡»"æ‰¹é‡è®¡ç®—"æŒ‰é’®è¿›è¡Œè®¡ç®—', 'success');
            
            // æ›´æ–°æˆæœ¬é¢„è§ˆï¼ˆå› ä¸ºå‚è€ƒå”®ä»·å¯èƒ½å˜åŒ–ï¼‰
            updateCostPreview();
        }
        
        // æ·»åŠ SKU
        function addSKU() {
            const newId = skuList.length > 0 ? Math.max(...skuList.map(sku => sku.id)) + 1 : 1;
            skuList.push({
                id: newId,
                name: `SKU-${String(newId).padStart(3, '0')}`,
                cost: 0,
                targetPrice: 0,
                directDiscountType: 'percent',
                directDiscountValue: 0,
                couponDiscountType: 'percent',
                couponDiscountValue: 0,
                directDiscount: 0,
                couponAmount: 0,
                finalPrice: 0,
                grossProfit: 0,
                grossMargin: 0,
                costMargin: 0,
                netProfit: 0,
                netMargin: 0,
                // æ–°å¢å­—æ®µï¼šæŠ˜æ‰£é¢„è§ˆ
                directDiscountPreview: 0,
                couponDiscountPreview: 0,
                priceAfterDirect: 0,
                priceAfterAll: 0,
                // ç»„åˆä¿ƒé”€å­—æ®µ
                comboDiscounts: {
                    two: 0,
                    three: 0,
                    four: 0
                },
                // æ–°å¢å­—æ®µï¼šç»„åˆç›®æ ‡å”®ä»·
                comboTargetPrices: {
                    one: 0,
                    two: 0,
                    three: 0,
                    four: 0
                }
            });
            
            updateSKUTable();
            updateSkuSelector();
            updateReverseSkuSelector();
            // éšè—ç©ºçŠ¶æ€æç¤º
            document.getElementById('emptyState').style.display = 'none';
        }
        
        // ç§»é™¤SKU
        function removeSKU(id) {
            skuList = skuList.filter(sku => sku.id !== id);
            updateSKUTable();
            updateSkuSelector();
            updateReverseSkuSelector();
            
            // å¦‚æœæ²¡æœ‰SKUäº†ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
            if (skuList.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
            }
            
            // æ›´æ–°æˆæœ¬é¢„è§ˆ
            updateCostPreview();
        }
        
        // æ›´æ–°SKUè¡¨æ ¼
        function updateSKUTable() {
            const tbody = document.getElementById('skuTableBody');
            tbody.innerHTML = '';
            
            skuList.forEach(sku => {
                // è®¡ç®—æŠ˜æ‰£é¢„è§ˆ
                updateDiscountPreview(sku);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="table-cell-input">
                        <input type="text" class="sku-name" value="${sku.name || ''}" data-id="${sku.id}" placeholder="SKUåç§°">
                        <span class="enter-hint">Enter</span>
                    </td>
                    <td class="table-cell-input">
                        <input type="number" class="sku-cost" value="${sku.cost || ''}" min="0" step="0.01" data-id="${sku.id}" placeholder="æˆæœ¬ä»·">
                        <span class="enter-hint">Enter</span>
                    </td>
                    <td class="table-cell-input">
                        <input type="number" class="sku-target-price" value="${sku.targetPrice || ''}" min="0" step="0.01" data-id="${sku.id}" placeholder="å¯¹æ ‡åŒè¡Œ">
                        <span class="enter-hint">Enter</span>
                    </td>
                    <td>
                        <div class="discount-input-group">
                            <div class="discount-type" data-id="${sku.id}" data-type="direct">
                                <button class="type-btn ${sku.directDiscountType === 'percent' ? 'active' : ''}" data-type="percent">%</button>
                                <button class="type-btn ${sku.directDiscountType === 'amount' ? 'active' : ''}" data-type="amount">å…ƒ</button>
                            </div>
                            <div class="table-cell-input">
                                <input type="number" class="sku-direct-discount-value" value="${sku.directDiscountValue || ''}" min="0" step="0.1" data-id="${sku.id}" placeholder="ç›´é™å€¼">
                                <span class="enter-hint">Enter</span>
                            </div>
                        </div>
                        <div class="discount-preview" data-id="${sku.id}" data-type="direct">
                            <div class="discount-preview-row">
                                <span class="discount-preview-label">å•å“ç›´é™ï¼š</span>
                                <span class="discount-preview-value ${getDiscountAmountColor(sku.directDiscountPreview, sku.targetPrice, 'direct')}" id="directPreviewAmount_${sku.id}">${sku.targetPrice > 0 ? sku.directDiscountPreview.toFixed(2) + 'å…ƒ' : 'éœ€è¾“å…¥å”®ä»·'}</span>
                            </div>
                            <div class="discount-preview-row">
                                <span class="discount-preview-label">ç›´é™åä»·æ ¼ï¼š</span>
                                <span class="discount-preview-value primary" id="priceAfterDirect_${sku.id}">${sku.targetPrice > 0 ? sku.priceAfterDirect.toFixed(2) + 'å…ƒ' : '-'}</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="discount-input-group">
                            <div class="discount-type" data-id="${sku.id}" data-type="coupon">
                                <button class="type-btn ${sku.couponDiscountType === 'percent' ? 'active' : ''}" data-type="percent">%</button>
                                <button class="type-btn ${sku.couponDiscountType === 'amount' ? 'active' : ''}" data-type="amount">å…ƒ</button>
                            </div>
                            <div class="table-cell-input">
                                <input type="number" class="sku-coupon-discount-value" value="${sku.couponDiscountValue || ''}" min="0" step="0.1" data-id="${sku.id}" placeholder="ä¼˜æƒ åˆ¸å€¼">
                                <span class="enter-hint">Enter</span>
                            </div>
                        </div>
                        <div class="discount-preview" data-id="${sku.id}" data-type="coupon">
                            <div class="discount-preview-row">
                                <span class="discount-preview-label">ä¼˜æƒ åˆ¸ï¼š</span>
                                <span class="discount-preview-value ${getDiscountAmountColor(sku.couponDiscountPreview, sku.priceAfterDirect, 'coupon')}" id="couponPreviewAmount_${sku.id}">${sku.targetPrice > 0 ? sku.couponDiscountPreview.toFixed(2) + 'å…ƒ' : 'éœ€è¾“å…¥å”®ä»·'}</span>
                            </div>
                            <div class="discount-preview-row discount-preview-total">
                                <span class="discount-preview-label">åˆè®¡ä¼˜æƒ ï¼š</span>
                                <span class="discount-preview-value warning" id="totalDiscount_${sku.id}">${sku.targetPrice > 0 ? (sku.directDiscountPreview + sku.couponDiscountPreview).toFixed(2) + 'å…ƒ' : '-'}</span>
                            </div>
                        </div>
                    </td>
                    <td class="sku-final-price ${sku.finalPrice > 0 ? 'profit-positive' : ''}">${sku.finalPrice > 0 ? sku.finalPrice.toFixed(2) : '-'}</td>
                    <td class="sku-gross-profit ${getProfitColor(sku.grossProfit)}">${sku.grossProfit > 0 ? sku.grossProfit.toFixed(2) : '-'}</td>
                    <td class="sku-gross-margin ${getMarginColor(sku.grossMargin)}">${sku.grossMargin > 0 ? sku.grossMargin.toFixed(1) + '%' : '-'}</td>
                    <td class="sku-cost-margin ${getCostMarginColor(sku.costMargin)}">${sku.costMargin > 0 ? sku.costMargin.toFixed(1) + '%' : '-'}</td>
                    <td class="sku-net-profit ${getProfitColor(sku.netProfit)}">${sku.netProfit > 0 ? sku.netProfit.toFixed(2) : '-'}</td>
                    <td class="sku-net-margin ${getMarginColor(sku.netMargin)}">${sku.netMargin > 0 ? sku.netMargin.toFixed(1) + '%' : '-'}</td>
                    <td>
                        <div class="sku-actions">
                            <button class="sku-btn calc" data-id="${sku.id}">è®¡ç®—</button>
                            <button class="sku-btn remove" data-id="${sku.id}">åˆ é™¤</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // æ›´æ–°SKUè®¡æ•°
            document.getElementById('skuCount').textContent = skuList.length;
            
            // ç»‘å®šSKUè¡Œå†…äº‹ä»¶
            bindSKURowEvents();
        }
        
        // è®¡ç®—æŠ˜æ‰£é¢„è§ˆ
        function updateDiscountPreview(sku) {
            if (!sku.targetPrice || sku.targetPrice <= 0) {
                sku.directDiscountPreview = 0;
                sku.couponDiscountPreview = 0;
                sku.priceAfterDirect = 0;
                sku.priceAfterAll = 0;
                return;
            }
            
            // è®¡ç®—å•å“ç›´é™é‡‘é¢
            if (sku.directDiscountType === 'percent') {
                sku.directDiscountPreview = sku.targetPrice * (sku.directDiscountValue / 100);
            } else {
                sku.directDiscountPreview = parseFloat(sku.directDiscountValue) || 0;
            }
            
            // è®¡ç®—ç›´é™åä»·æ ¼
            sku.priceAfterDirect = sku.targetPrice - sku.directDiscountPreview;
            if (sku.priceAfterDirect < 0) sku.priceAfterDirect = 0;
            
            // è®¡ç®—ä¼˜æƒ åˆ¸é‡‘é¢
            if (sku.couponDiscountType === 'percent') {
                sku.couponDiscountPreview = sku.priceAfterDirect * (sku.couponDiscountValue / 100);
            } else {
                sku.couponDiscountPreview = parseFloat(sku.couponDiscountValue) || 0;
            }
            
            // è®¡ç®—åˆè®¡åä»·æ ¼
            sku.priceAfterAll = sku.priceAfterDirect - sku.couponDiscountPreview;
            if (sku.priceAfterAll < 0) sku.priceAfterAll = 0;
        }
        
        // æ›´æ–°æŠ˜æ‰£é¢„è§ˆæ˜¾ç¤º
        function updateDiscountPreviewDisplay(id) {
            const sku = skuList.find(s => s.id === id);
            if (!sku) return;
            
            // æ›´æ–°æŠ˜æ‰£é¢„è§ˆæ•°æ®
            updateDiscountPreview(sku);
            
            // æ›´æ–°æ˜¾ç¤º
            const directPreviewElement = document.getElementById(`directPreviewAmount_${id}`);
            const priceAfterDirectElement = document.getElementById(`priceAfterDirect_${id}`);
            const couponPreviewElement = document.getElementById(`couponPreviewAmount_${id}`);
            const totalDiscountElement = document.getElementById(`totalDiscount_${id}`);
            
            if (directPreviewElement && sku.targetPrice > 0) {
                directPreviewElement.textContent = sku.directDiscountPreview.toFixed(2) + 'å…ƒ';
                directPreviewElement.className = `discount-preview-value ${getDiscountAmountColor(sku.directDiscountPreview, sku.targetPrice, 'direct')}`;
            } else if (directPreviewElement) {
                directPreviewElement.textContent = 'éœ€è¾“å…¥å”®ä»·';
                directPreviewElement.className = 'discount-preview-value';
            }
            
            if (priceAfterDirectElement && sku.targetPrice > 0) {
                priceAfterDirectElement.textContent = sku.priceAfterDirect.toFixed(2) + 'å…ƒ';
            } else if (priceAfterDirectElement) {
                priceAfterDirectElement.textContent = '-';
            }
            
            if (couponPreviewElement && sku.targetPrice > 0) {
                couponPreviewElement.textContent = sku.couponDiscountPreview.toFixed(2) + 'å…ƒ';
                couponPreviewElement.className = `discount-preview-value ${getDiscountAmountColor(sku.couponDiscountPreview, sku.priceAfterDirect, 'coupon')}`;
            } else if (couponPreviewElement) {
                couponPreviewElement.textContent = 'éœ€è¾“å…¥å”®ä»·';
                couponPreviewElement.className = 'discount-preview-value';
            }
            
            if (totalDiscountElement && sku.targetPrice > 0) {
                const totalDiscount = sku.directDiscountPreview + sku.couponDiscountPreview;
                totalDiscountElement.textContent = totalDiscount.toFixed(2) + 'å…ƒ';
                
                // æ ¹æ®æ€»æŠ˜æ‰£æ¯”ä¾‹æ·»åŠ é¢œè‰²æç¤º
                const discountRate = (totalDiscount / sku.targetPrice) * 100;
                totalDiscountElement.className = `discount-preview-value ${getTotalDiscountColor(discountRate)}`;
            } else if (totalDiscountElement) {
                totalDiscountElement.textContent = '-';
                totalDiscountElement.className = 'discount-preview-value';
            }
        }
        
        // è·å–æŠ˜æ‰£é‡‘é¢é¢œè‰²
        function getDiscountAmountColor(discountAmount, basePrice, discountType) {
            if (!basePrice || basePrice <= 0) return '';
            
            const discountRate = (discountAmount / basePrice) * 100;
            
            if (discountType === 'direct') {
                // å•å“ç›´é™é¢œè‰²åˆ¤æ–­
                if (discountRate > 30) return 'danger'; // è¶…è¿‡30%é£é™©é«˜
                if (discountRate > 20) return 'warning'; // 20-30%éœ€è¦è°¨æ…
                if (discountRate > 10) return ''; // 10-20%æ­£å¸¸
                return 'primary'; // 10%ä»¥å†…æ¯”è¾ƒå®‰å…¨
            } else {
                // ä¼˜æƒ åˆ¸é¢œè‰²åˆ¤æ–­
                if (discountRate > 15) return 'danger'; // è¶…è¿‡15%é£é™©é«˜
                if (discountRate > 10) return 'warning'; // 10-15%éœ€è¦è°¨æ…
                if (discountRate > 5) return ''; // 5-10%æ­£å¸¸
                return 'primary'; // 5%ä»¥å†…æ¯”è¾ƒå®‰å…¨
            }
        }
        
        // è·å–æ€»æŠ˜æ‰£é¢œè‰²
        function getTotalDiscountColor(discountRate) {
            if (discountRate > 40) return 'danger'; // è¶…è¿‡40%é£é™©æé«˜
            if (discountRate > 30) return 'warning'; // 30-40%é£é™©é«˜
            if (discountRate > 20) return ''; // 20-30%æ­£å¸¸ä¿ƒé”€
            return 'primary'; // 20%ä»¥å†…å®‰å…¨
        }
        
        // è·å–åˆ©æ¶¦é¢œè‰²ç±»
        function getProfitColor(profit) {
            if (profit > 100) return 'profit-high';
            if (profit > 50) return 'profit-medium';
            if (profit > 20) return 'profit-low';
            if (profit > 0) return 'profit-very-low';
            return 'profit-negative';
        }
        
        // è·å–åˆ©æ¶¦ç‡é¢œè‰²ç±»ï¼ˆå”®ä»·æ¯›åˆ©ç‡ï¼‰
        function getMarginColor(margin) {
            if (margin > 40) return 'profit-high';
            if (margin > 25) return 'profit-medium';
            if (margin > 15) return 'profit-low';
            if (margin > 0) return 'profit-very-low';
            return 'profit-negative';
        }
        
        // è·å–æˆæœ¬æ¯›åˆ©ç‡é¢œè‰²ç±»
        function getCostMarginColor(costMargin) {
            if (costMargin > 150) return 'profit-high'; // è¶…è¿‡150%è¶…é«˜åˆ©æ¶¦
            if (costMargin > 80) return 'profit-medium'; // 80-150%é«˜åˆ©æ¶¦
            if (costMargin > 40) return 'profit-low'; // 40-80%ä¸­ç­‰åˆ©æ¶¦
            if (costMargin > 20) return 'profit-very-low'; // 20-40%ä½åˆ©æ¶¦
            if (costMargin > 0) return 'profit-negative'; // 0-20%å¾®åˆ©
            return 'profit-negative'; // äºæŸ
        }
        
        // ç»‘å®šSKUè¡Œå†…äº‹ä»¶ - ä½¿ç”¨é˜²æŠ–
        function bindSKURowEvents() {
            // ç»‘å®šSKUåç§°è¾“å…¥äº‹ä»¶
            document.querySelectorAll('.sku-name').forEach(input => {
                input.addEventListener('input', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const sku = skuList.find(s => s.id === id);
                    if (sku) sku.name = this.value;
                    updateSkuSelector();
                    updateReverseSkuSelector();
                });
                
                // æ·»åŠ å›è½¦é”®äº‹ä»¶
                addEnterKeyListener(input, id => updateSingleSKU(id));
            });
            
            // ç»‘å®šæˆæœ¬è¾“å…¥äº‹ä»¶ - ä½¿ç”¨é˜²æŠ–
            document.querySelectorAll('.sku-cost').forEach(input => {
                input.addEventListener('input', debounce(function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const sku = skuList.find(s => s.id === id);
                    if (sku) {
                        sku.cost = parseFloat(this.value) || 0;
                        updateDiscountPreviewDisplay(id); // æ›´æ–°æŠ˜æ‰£é¢„è§ˆ
                    }
                }, 800));
                
                // æ·»åŠ å›è½¦é”®äº‹ä»¶
                addEnterKeyListener(input, id => updateSingleSKU(id));
            });
            
            // ç»‘å®šç›®æ ‡å”®ä»·è¾“å…¥äº‹ä»¶ - ä½¿ç”¨é˜²æŠ–
            document.querySelectorAll('.sku-target-price').forEach(input => {
                input.addEventListener('input', debounce(function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const sku = skuList.find(s => s.id === id);
                    if (sku) {
                        sku.targetPrice = parseFloat(this.value) || 0;
                        // å®æ—¶æ›´æ–°æŠ˜æ‰£é¢„è§ˆ
                        updateDiscountPreviewDisplay(id);
                    }
                }, 500));
                
                // æ·»åŠ å›è½¦é”®äº‹ä»¶
                addEnterKeyListener(input, id => updateSingleSKU(id));
            });
            
            // ç»‘å®šå•å“ç›´é™å€¼è¾“å…¥äº‹ä»¶ - ä½¿ç”¨é˜²æŠ–
            document.querySelectorAll('.sku-direct-discount-value').forEach(input => {
                input.addEventListener('input', debounce(function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const sku = skuList.find(s => s.id === id);
                    if (sku) {
                        sku.directDiscountValue = parseFloat(this.value) || 0;
                        // å®æ—¶æ›´æ–°æŠ˜æ‰£é¢„è§ˆ
                        updateDiscountPreviewDisplay(id);
                    }
                }, 500));
                
                // æ·»åŠ å›è½¦é”®äº‹ä»¶
                addEnterKeyListener(input, id => updateSingleSKU(id));
            });
            
            // ç»‘å®šä¼˜æƒ åˆ¸å€¼è¾“å…¥äº‹ä»¶ - ä½¿ç”¨é˜²æŠ–
            document.querySelectorAll('.sku-coupon-discount-value').forEach(input => {
                input.addEventListener('input', debounce(function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const sku = skuList.find(s => s.id === id);
                    if (sku) {
                        sku.couponDiscountValue = parseFloat(this.value) || 0;
                        // å®æ—¶æ›´æ–°æŠ˜æ‰£é¢„è§ˆ
                        updateDiscountPreviewDisplay(id);
                    }
                }, 500));
                
                // æ·»åŠ å›è½¦é”®äº‹ä»¶
                addEnterKeyListener(input, id => updateSingleSKU(id));
            });
            
            // ç»‘å®šæŠ˜æ‰£ç±»å‹åˆ‡æ¢äº‹ä»¶
            document.querySelectorAll('.discount-type').forEach(container => {
                const id = parseInt(container.getAttribute('data-id'));
                const type = container.getAttribute('data-type'); // 'direct' æˆ– 'coupon'
                
                container.querySelectorAll('.type-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const discountType = this.getAttribute('data-type');
                        const sku = skuList.find(s => s.id === id);
                        
                        if (sku) {
                            if (type === 'direct') {
                                sku.directDiscountType = discountType;
                            } else {
                                sku.couponDiscountType = discountType;
                            }
                            
                            // æ›´æ–°æŒ‰é’®çŠ¶æ€
                            container.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                            this.classList.add('active');
                            
                            // å®æ—¶æ›´æ–°æŠ˜æ‰£é¢„è§ˆ
                            updateDiscountPreviewDisplay(id);
                        }
                    });
                });
            });
            
            // ç»‘å®šå•ä¸ªSKUè®¡ç®—æŒ‰é’®
            document.querySelectorAll('.sku-btn.calc').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    updateSingleSKU(id);
                });
            });
            
            // ç»‘å®šåˆ é™¤æŒ‰é’®
            document.querySelectorAll('.sku-btn.remove').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    removeSKU(id);
                });
            });
        }
        
        // æ·»åŠ å›è½¦é”®ç›‘å¬å™¨
        function addEnterKeyListener(inputElement, callback) {
            inputElement.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const id = parseInt(this.getAttribute('data-id'));
                    
                    // æ›´æ–°æ•°æ®ï¼ˆç«‹å³æ›´æ–°ï¼Œä¸ç­‰å¾…é˜²æŠ–ï¼‰
                    const sku = skuList.find(s => s.id === id);
                    if (sku) {
                        const value = this.value.trim();
                        
                        // æ ¹æ®è¾“å…¥æ¡†ç±»å‹æ›´æ–°ç›¸åº”çš„å­—æ®µ
                        if (this.classList.contains('sku-name')) {
                            sku.name = value;
                        } else if (this.classList.contains('sku-cost')) {
                            sku.cost = parseFloat(value) || 0;
                        } else if (this.classList.contains('sku-target-price')) {
                            sku.targetPrice = parseFloat(value) || 0;
                        } else if (this.classList.contains('sku-direct-discount-value')) {
                            sku.directDiscountValue = parseFloat(value) || 0;
                        } else if (this.classList.contains('sku-coupon-discount-value')) {
                            sku.couponDiscountValue = parseFloat(value) || 0;
                        }
                        
                        // æ›´æ–°æŠ˜æ‰£é¢„è§ˆ
                        updateDiscountPreviewDisplay(id);
                    }
                    
                    // æ‰§è¡Œè®¡ç®—
                    callback(id);
                    
                    // ç§»é™¤ç„¦ç‚¹ï¼Œéšè—å›è½¦æç¤º
                    this.blur();
                }
            });
        }
        
        // æ›´æ–°æ‰€æœ‰è®¡ç®—
        function updateAllCalculations() {
            calculateAllSKUs();
        }
        
        // æ›´æ–°å•ä¸ªSKU
        function updateSingleSKU(id) {
            const sku = skuList.find(s => s.id === id);
            if (!sku) return;
            
            // è·å–æˆæœ¬å‚æ•°
            const platformFeePercent = parseFloat(document.getElementById('platformFee').value) / 100 || 0;
            const kolFeePercent = parseFloat(document.getElementById('kolFee').value) / 100 || 0;
            const returnRatePercent = parseFloat(document.getElementById('returnRate').value) / 100 || 0;
            const otherCost = parseFloat(document.getElementById('otherCost').value) || 0;
            
            // å¦‚æœæ²¡æœ‰ç›®æ ‡å”®ä»·ï¼Œåˆ™æ— æ³•è®¡ç®—æœ€ç»ˆå”®ä»·å’Œåˆ©æ¶¦
            if (sku.targetPrice <= 0) {
                // é‡ç½®æ•°æ®
                sku.finalPrice = 0;
                sku.grossProfit = 0;
                sku.grossMargin = 0;
                sku.costMargin = 0;
                sku.netProfit = 0;
                sku.netMargin = 0;
                sku.directDiscount = 0;
                sku.couponAmount = 0;
                
                // æ›´æ–°è¡¨æ ¼æ˜¾ç¤º
                updateSKUTable();
                showNotification('è¯·å…ˆå¡«å†™ç›®æ ‡å”®ä»·', 'warning');
                return;
            }
            
            // åŸºå‡†ä»·ä¸ºç›®æ ‡å”®ä»·
            const basePrice = sku.targetPrice;
            
            // è®¡ç®—å•å“ç›´é™é‡‘é¢
            let directDiscountAmount = 0;
            if (sku.directDiscountType === 'percent') {
                directDiscountAmount = basePrice * (sku.directDiscountValue / 100);
            } else {
                directDiscountAmount = sku.directDiscountValue;
            }
            
            // è®¡ç®—ä¼˜æƒ åˆ¸é‡‘é¢ï¼ˆåŸºäºå•å“ç›´é™åä»·æ ¼ï¼‰
            const priceAfterDirect = basePrice - directDiscountAmount;
            let couponAmount = 0;
            
            if (sku.couponDiscountType === 'percent') {
                couponAmount = priceAfterDirect * (sku.couponDiscountValue / 100);
            } else {
                couponAmount = sku.couponDiscountValue;
            }
            
            sku.directDiscount = directDiscountAmount;
            sku.couponAmount = couponAmount;
            
            // è®¡ç®—æœ€ç»ˆå”®ä»·
            sku.finalPrice = basePrice - directDiscountAmount - couponAmount;
            
            // è®¡ç®—åˆ©æ¶¦ï¼ˆå¿…é¡»æœ‰æˆæœ¬ä»·ï¼‰
            if (sku.finalPrice > 0 && sku.cost > 0) {
                // è®¡ç®—æ¯›åˆ©æ¶¦
                sku.grossProfit = sku.finalPrice - sku.cost;
                
                // è®¡ç®—å”®ä»·æ¯›åˆ©ç‡ï¼š(å”®ä»·-æˆæœ¬)/å”®ä»·Ã—100%
                sku.grossMargin = sku.finalPrice > 0 ? (sku.grossProfit / sku.finalPrice) * 100 : 0;
                
                // è®¡ç®—æˆæœ¬æ¯›åˆ©ç‡ï¼š(å”®ä»·-æˆæœ¬)/æˆæœ¬Ã—100%
                sku.costMargin = sku.cost > 0 ? (sku.grossProfit / sku.cost) * 100 : 0;
                
                // è®¡ç®—å…¶ä»–æˆæœ¬
                const platformFee = sku.finalPrice * platformFeePercent;
                const kolFee = sku.finalPrice * kolFeePercent;
                const returnLoss = sku.finalPrice * returnRatePercent;
                const totalOtherCosts = platformFee + kolFee + returnLoss + otherCost;
                
                // è®¡ç®—å‡€åˆ©æ¶¦
                sku.netProfit = sku.grossProfit - totalOtherCosts;
                sku.netMargin = sku.finalPrice > 0 ? (sku.netProfit / sku.finalPrice) * 100 : 0;
            } else {
                sku.grossProfit = 0;
                sku.grossMargin = 0;
                sku.costMargin = 0;
                sku.netProfit = 0;
                sku.netMargin = 0;
            }
            
            // æ›´æ–°è¡¨æ ¼æ˜¾ç¤º
            updateSKUTable();
            updateSkuSelector();
            updateReverseSkuSelector();
            
            // æ›´æ–°æˆæœ¬é¢„è§ˆï¼ˆå› ä¸ºå‚è€ƒå”®ä»·å¯èƒ½å˜åŒ–ï¼‰
            updateCostPreview();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            if (sku.finalPrice > 0 && sku.cost > 0) {
                showNotification(`${sku.name} è®¡ç®—å®Œæˆï¼æœ€ç»ˆå”®ä»·ï¼šÂ¥${sku.finalPrice.toFixed(2)}ï¼Œå”®ä»·æ¯›åˆ©ç‡ï¼š${sku.grossMargin.toFixed(1)}%ï¼Œæˆæœ¬æ¯›åˆ©ç‡ï¼š${sku.costMargin.toFixed(1)}%`, 'success');
            }
        }
        
        // è®¡ç®—æ‰€æœ‰SKU
        function calculateAllSKUs() {
            let calculatedCount = 0;
            let missingTargetPriceCount = 0;
            let missingCostCount = 0;
            
            skuList.forEach(sku => {
                if (sku.targetPrice > 0 && sku.cost > 0) {
                    updateSingleSKU(sku.id);
                    calculatedCount++;
                } else {
                    if (sku.targetPrice <= 0) missingTargetPriceCount++;
                    if (sku.cost <= 0) missingCostCount++;
                }
            });
            
            if (calculatedCount > 0) {
                showNotification(`æˆåŠŸè®¡ç®— ${calculatedCount} ä¸ªSKU`, 'success');
                if (missingTargetPriceCount > 0 || missingCostCount > 0) {
                    const missingMsg = [];
                    if (missingTargetPriceCount > 0) missingMsg.push(`${missingTargetPriceCount}ä¸ªSKUç¼ºå°‘ç›®æ ‡å”®ä»·`);
                    if (missingCostCount > 0) missingMsg.push(`${missingCostCount}ä¸ªSKUç¼ºå°‘æˆæœ¬ä»·`);
                    showNotification(`${missingMsg.join('ï¼Œ')}ï¼Œæ— æ³•è®¡ç®—`, 'warning');
                }
                
                // æ›´æ–°SKUé€‰æ‹©å™¨
                updateSkuSelector();
                updateReverseSkuSelector();
                
                // æ›´æ–°æˆæœ¬é¢„è§ˆ
                updateCostPreview();
            } else {
                showNotification('è¯·å…ˆå¡«å†™SKUçš„æˆæœ¬ä»·å’Œç›®æ ‡å”®ä»·', 'warning');
            }
        }
        
        // åå‘è®¡ç®—ï¼šæ ¹æ®æœ€ç»ˆå”®ä»·åæ¨ç›®æ ‡å”®ä»·
        function calculateReversePrice() {
            const skuId = parseInt(document.getElementById('reverseSkuSelect').value);
            if (!skuId) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªSKUè¿›è¡Œåå‘è®¡ç®—', 'warning');
                return;
            }
            
            const finalPrice = parseFloat(document.getElementById('reverseFinalPrice').value);
            if (!finalPrice || finalPrice <= 0) {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„æœ€ç»ˆå”®ä»·', 'warning');
                return;
            }
            
            const directDiscountValue = parseFloat(document.getElementById('reverseDirectDiscountValue').value) || 0;
            const couponDiscountValue = parseFloat(document.getElementById('reverseCouponDiscountValue').value) || 0;
            
            // æ ¹æ®æŠ˜æ‰£ç±»å‹è®¡ç®—ç›®æ ‡å”®ä»·
            let targetPrice = 0;
            let directDiscountAmount = 0;
            let couponAmount = 0;
            
            // è®¡ç®—å…¬å¼æ¨å¯¼ï¼š
            // æƒ…å†µ1ï¼šå•å“ç›´é™ä¸ºç™¾åˆ†æ¯”ï¼Œä¼˜æƒ åˆ¸ä¸ºç™¾åˆ†æ¯”
            if (reverseDirectDiscountType === 'percent' && reverseCouponDiscountType === 'percent') {
                // æœ€ç»ˆå”®ä»· = ç›®æ ‡å”®ä»· Ã— (1 - å•å“ç›´é™æ¯”ä¾‹) Ã— (1 - ä¼˜æƒ åˆ¸æ¯”ä¾‹)
                // æ‰€ä»¥ï¼šç›®æ ‡å”®ä»· = æœ€ç»ˆå”®ä»· / ((1 - å•å“ç›´é™æ¯”ä¾‹) Ã— (1 - ä¼˜æƒ åˆ¸æ¯”ä¾‹))
                targetPrice = finalPrice / ((1 - directDiscountValue/100) * (1 - couponDiscountValue/100));
                directDiscountAmount = targetPrice * (directDiscountValue/100);
                couponAmount = (targetPrice - directDiscountAmount) * (couponDiscountValue/100);
            }
            // æƒ…å†µ2ï¼šå•å“ç›´é™ä¸ºç™¾åˆ†æ¯”ï¼Œä¼˜æƒ åˆ¸ä¸ºå›ºå®šé‡‘é¢
            else if (reverseDirectDiscountType === 'percent' && reverseCouponDiscountType === 'amount') {
                // æœ€ç»ˆå”®ä»· = ç›®æ ‡å”®ä»· Ã— (1 - å•å“ç›´é™æ¯”ä¾‹) - ä¼˜æƒ åˆ¸é‡‘é¢
                // æ‰€ä»¥ï¼šç›®æ ‡å”®ä»· = (æœ€ç»ˆå”®ä»· + ä¼˜æƒ åˆ¸é‡‘é¢) / (1 - å•å“ç›´é™æ¯”ä¾‹)
                targetPrice = (finalPrice + couponDiscountValue) / (1 - directDiscountValue/100);
                directDiscountAmount = targetPrice * (directDiscountValue/100);
                couponAmount = couponDiscountValue;
            }
            // æƒ…å†µ3ï¼šå•å“ç›´é™ä¸ºå›ºå®šé‡‘é¢ï¼Œä¼˜æƒ åˆ¸ä¸ºç™¾åˆ†æ¯”
            else if (reverseDirectDiscountType === 'amount' && reverseCouponDiscountType === 'percent') {
                // æœ€ç»ˆå”®ä»· = (ç›®æ ‡å”®ä»· - å•å“ç›´é™é‡‘é¢) Ã— (1 - ä¼˜æƒ åˆ¸æ¯”ä¾‹)
                // æ‰€ä»¥ï¼šç›®æ ‡å”®ä»· = æœ€ç»ˆå”®ä»· / (1 - ä¼˜æƒ åˆ¸æ¯”ä¾‹) + å•å“ç›´é™é‡‘é¢
                targetPrice = finalPrice / (1 - couponDiscountValue/100) + directDiscountValue;
                directDiscountAmount = directDiscountValue;
                couponAmount = (targetPrice - directDiscountAmount) * (couponDiscountValue/100);
            }
            // æƒ…å†µ4ï¼šå•å“ç›´é™ä¸ºå›ºå®šé‡‘é¢ï¼Œä¼˜æƒ åˆ¸ä¸ºå›ºå®šé‡‘é¢
            else if (reverseDirectDiscountType === 'amount' && reverseCouponDiscountType === 'amount') {
                // æœ€ç»ˆå”®ä»· = ç›®æ ‡å”®ä»· - å•å“ç›´é™é‡‘é¢ - ä¼˜æƒ åˆ¸é‡‘é¢
                // æ‰€ä»¥ï¼šç›®æ ‡å”®ä»· = æœ€ç»ˆå”®ä»· + å•å“ç›´é™é‡‘é¢ + ä¼˜æƒ åˆ¸é‡‘é¢
                targetPrice = finalPrice + directDiscountValue + couponDiscountValue;
                directDiscountAmount = directDiscountValue;
                couponAmount = couponDiscountValue;
            }
            
            // éªŒè¯è®¡ç®—
            const verification = targetPrice - directDiscountAmount - couponAmount;
            
            // æ˜¾ç¤ºç»“æœ
            document.getElementById('reverseTargetPriceResult').textContent = targetPrice.toFixed(2) + ' å…ƒ';
            document.getElementById('reverseDirectDiscountAmount').textContent = directDiscountAmount.toFixed(2) + ' å…ƒ';
            document.getElementById('reverseCouponAmount').textContent = couponAmount.toFixed(2) + ' å…ƒ';
            document.getElementById('reverseVerification').textContent = verification.toFixed(2) + ' å…ƒ';
            
            // æ›´æ–°è®¡ç®—å…¬å¼æ–‡æœ¬
            document.getElementById('reverseTargetPriceText').textContent = targetPrice.toFixed(2);
            document.getElementById('reverseDirectText').textContent = directDiscountAmount.toFixed(2);
            document.getElementById('reverseCouponText').textContent = couponAmount.toFixed(2);
            document.getElementById('reverseFinalText').textContent = verification.toFixed(2);
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('reverseResult').style.display = 'block';
            
            // ä¿å­˜åå‘è®¡ç®—ç»“æœ
            reverseCalcSku = skuList.find(sku => sku.id === skuId);
            if (reverseCalcSku) {
                reverseCalcSku.reverseCalcResult = {
                    targetPrice: targetPrice,
                    finalPrice: finalPrice,
                    directDiscountAmount: directDiscountAmount,
                    couponAmount: couponAmount,
                    directDiscountType: reverseDirectDiscountType,
                    directDiscountValue: directDiscountValue,
                    couponDiscountType: reverseCouponDiscountType,
                    couponDiscountValue: couponDiscountValue
                };
            }
            
            showNotification(`åå‘è®¡ç®—å®Œæˆï¼ç›®æ ‡å”®ä»·åº”ä¸ºï¼šÂ¥${targetPrice.toFixed(2)}`, 'success');
        }
        
        // å¤åˆ¶åå‘è®¡ç®—ç»“æœåˆ°SKUç®¡ç†
        function copyReverseResultToSKU() {
            if (!reverseCalcSku || !reverseCalcSku.reverseCalcResult) {
                showNotification('è¯·å…ˆè¿›è¡Œåå‘è®¡ç®—', 'warning');
                return;
            }
            
            const result = reverseCalcSku.reverseCalcResult;
            
            // æ›´æ–°SKUæ•°æ®
            reverseCalcSku.targetPrice = result.targetPrice;
            reverseCalcSku.directDiscountType = result.directDiscountType;
            reverseCalcSku.directDiscountValue = result.directDiscountValue;
            reverseCalcSku.couponDiscountType = result.couponDiscountType;
            reverseCalcSku.couponDiscountValue = result.couponDiscountValue;
            
            // æ›´æ–°SKUè¡¨æ ¼
            updateSKUTable();
            
            // é‡æ–°è®¡ç®—è¯¥SKU
            updateSingleSKU(reverseCalcSku.id);
            
            showNotification(`å·²å°†åå‘è®¡ç®—ç»“æœåº”ç”¨åˆ° ${reverseCalcSku.name}`, 'success');
        }
        
        // é‡ç½®åå‘è®¡ç®—
        function resetReverseCalculation() {
            document.getElementById('reverseFinalPrice').value = '';
            document.getElementById('reverseDirectDiscountValue').value = '';
            document.getElementById('reverseCouponDiscountValue').value = '';
            document.getElementById('reverseResult').style.display = 'none';
            document.getElementById('reverseSkuSelect').value = '';
            reverseCalcSku = null;
            
            showNotification('åå‘è®¡ç®—è®¾ç½®å·²é‡ç½®', 'success');
        }
        
        // åˆ†æç»„åˆå®šä»·
        function analyzeComboPricing() {
            const skuId = parseInt(document.getElementById('comboSkuSelect').value);
            if (!skuId) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªSKUè¿›è¡Œåˆ†æ', 'warning');
                return;
            }
            
            selectedComboSku = skuList.find(sku => sku.id === skuId);
            if (!selectedComboSku) {
                showNotification('é€‰æ‹©çš„SKUä¸å­˜åœ¨', 'error');
                return;
            }
            
            if (selectedComboSku.finalPrice <= 0) {
                showNotification('è¯·å…ˆè®¡ç®—è¯¥SKUçš„æœ€ç»ˆå”®ä»·', 'warning');
                return;
            }
            
            // å¦‚æœæœ‰ä¿å­˜çš„ç»„åˆæ•°æ®ï¼ŒåŠ è½½å®ƒ
            if (comboData[skuId]) {
                loadComboSettings(skuId);
            } else {
                // å¦åˆ™ä½¿ç”¨é»˜è®¤è®¾ç½®
                resetComboSettings();
            }
            
            calculateComboPricing();
            showNotification(`å¼€å§‹åˆ†æ ${selectedComboSku.name} çš„ç»„åˆå®šä»·`, 'success');
        }
        
        // è®¡ç®—ç»„åˆå®šä»·
        function calculateComboPricing() {
            if (!selectedComboSku || selectedComboSku.finalPrice <= 0) {
                return;
            }
            
            // ä½¿ç”¨æœ€ç»ˆå”®ä»·ï¼ˆå·²åŒ…å«å•å“ç›´é™å’Œä¼˜æƒ åˆ¸ï¼‰ä½œä¸ºå•ä¹°ä»·æ ¼
            const singlePrice = selectedComboSku.finalPrice;
            
            // è·å–ç»„åˆä¼˜æƒ è®¾ç½®
            const twoDiscount = parseFloat(document.getElementById('twoComboDiscount').value) || 0;
            const threeDiscount = parseFloat(document.getElementById('threeComboDiscount').value) || 0;
            const fourDiscount = parseFloat(document.getElementById('fourComboDiscount').value) || 0;
            
            // ä¿å­˜åˆ°SKUæ•°æ®ä¸­
            selectedComboSku.comboDiscounts = {
                two: twoDiscount,
                three: threeDiscount,
                four: fourDiscount
            };
            
            // è®¡ç®—å„ç§ç»„åˆçš„ä»·æ ¼
            const combos = [
                { count: 1, label: 'å•ä¹°', discount: 0 },
                { count: 2, label: '2ç“¶ç»„åˆ', discount: twoDiscount },
                { count: 3, label: '3ç“¶ç»„åˆ', discount: threeDiscount },
                { count: 4, label: '4ç“¶ç»„åˆ', discount: fourDiscount }
            ];
            
            // æ›´æ–°å¡ç‰‡æ˜¾ç¤º
            combos.forEach(combo => {
                const originalTotal = singlePrice * combo.count;
                const finalTotal = originalTotal - combo.discount;
                const unitPrice = finalTotal / combo.count;
                const savePerUnit = singlePrice - unitPrice;
                const discountRate = (combo.discount / originalTotal) * 100;
                
                // æ›´æ–°å¡ç‰‡
                if (combo.count === 1) {
                    document.getElementById('singlePrice').textContent = `${finalTotal.toFixed(2)} å…ƒ`;
                    document.getElementById('singleUnitPrice').textContent = `æ¯ç“¶ï¼š${unitPrice.toFixed(2)} å…ƒ`;
                    document.getElementById('singleDiscount').textContent = 'åŸä»·';
                    document.getElementById('singleDiscount').className = 'discount-value';
                } else {
                    document.getElementById(`${combo.count === 2 ? 'two' : combo.count === 3 ? 'three' : 'four'}Price`).textContent = `${finalTotal.toFixed(2)} å…ƒ`;
                    document.getElementById(`${combo.count === 2 ? 'two' : combo.count === 3 ? 'three' : 'four'}UnitPrice`).textContent = `æ¯ç“¶ï¼š${unitPrice.toFixed(2)} å…ƒ`;
                    
                    const saveElement = document.getElementById(`${combo.count === 2 ? 'two' : combo.count === 3 ? 'three' : 'four'}SavePerUnit`);
                    saveElement.textContent = `${savePerUnit.toFixed(2)} å…ƒ`;
                    
                    // æ ¹æ®èŠ‚çœé‡‘é¢è®¾ç½®é¢œè‰²
                    if (savePerUnit > singlePrice * 0.15) {
                        saveElement.className = 'discount-value danger'; // èŠ‚çœå¤ªå¤šï¼Œå¯èƒ½å½±å“åˆ©æ¶¦
                    } else if (savePerUnit > singlePrice * 0.08) {
                        saveElement.className = 'discount-value warning'; // é€‚ä¸­ä¼˜æƒ 
                    } else if (savePerUnit > 0) {
                        saveElement.className = 'discount-value success'; // å°å¹…ä¼˜æƒ 
                    } else {
                        saveElement.className = 'discount-value'; // æ— ä¼˜æƒ 
                    }
                }
            });
            
            // æ›´æ–°ç»„åˆä¿ƒé”€åˆ†æè¡¨
            updateComboTable(combos, singlePrice);
        }
        
        // è®¡ç®—ç»„åˆSKUç›®æ ‡å”®ä»·ï¼ˆæ ¹æ®å•å“æŠ˜æ‰£åæ¨ï¼‰
        function calculateComboTargetPrice(finalPrice, count) {
            if (!selectedComboSku || !selectedComboSku.directDiscountType || !selectedComboSku.couponDiscountType) {
                return finalPrice; // å¦‚æœå•å“SKUæ²¡æœ‰è®¾ç½®æŠ˜æ‰£ï¼Œç›´æ¥è¿”å›æœ€ç»ˆå”®ä»·ä½œä¸ºç›®æ ‡å”®ä»·
            }
            
            // è®¡ç®—æ¯ç“¶çš„æœ€ç»ˆå”®ä»·
            const unitFinalPrice = finalPrice / count;
            
            // åå‘è®¡ç®—ï¼šå·²çŸ¥æœ€ç»ˆå”®ä»·ï¼Œæ±‚ç›®æ ‡å”®ä»·
            // æœ€ç»ˆå”®ä»· = ç›®æ ‡å”®ä»· - å•å“ç›´é™ - ä¼˜æƒ åˆ¸
            
            // å…ˆè®¡ç®—ä¼˜æƒ åˆ¸é‡‘é¢
            let couponDiscount = 0;
            if (selectedComboSku.couponDiscountType === 'percent') {
                // å¦‚æœä¼˜æƒ åˆ¸æ˜¯ç™¾åˆ†æ¯”ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“ç›´é™åçš„ä»·æ ¼
                // ä¼˜æƒ åˆ¸é‡‘é¢ = (ç›®æ ‡å”®ä»· - å•å“ç›´é™) Ã— ä¼˜æƒ åˆ¸æ¯”ä¾‹
                // æœ€ç»ˆå”®ä»· = (ç›®æ ‡å”®ä»· - å•å“ç›´é™) Ã— (1 - ä¼˜æƒ åˆ¸æ¯”ä¾‹)
                const priceAfterDirect = unitFinalPrice / (1 - selectedComboSku.couponDiscountValue / 100);
                couponDiscount = priceAfterDirect * (selectedComboSku.couponDiscountValue / 100);
            } else {
                // å¦‚æœä¼˜æƒ åˆ¸æ˜¯å›ºå®šé‡‘é¢
                couponDiscount = selectedComboSku.couponDiscountValue;
            }
            
            // è®¡ç®—å•å“ç›´é™åçš„ä»·æ ¼
            const priceAfterDirect = unitFinalPrice + couponDiscount;
            
            // å†è®¡ç®—å•å“ç›´é™é‡‘é¢
            let directDiscount = 0;
            if (selectedComboSku.directDiscountType === 'percent') {
                // å¦‚æœå•å“ç›´é™æ˜¯ç™¾åˆ†æ¯”
                // å•å“ç›´é™é‡‘é¢ = ç›®æ ‡å”®ä»· Ã— å•å“ç›´é™æ¯”ä¾‹
                // å•å“ç›´é™åä»·æ ¼ = ç›®æ ‡å”®ä»· Ã— (1 - å•å“ç›´é™æ¯”ä¾‹)
                const targetPrice = priceAfterDirect / (1 - selectedComboSku.directDiscountValue / 100);
                directDiscount = targetPrice * (selectedComboSku.directDiscountValue / 100);
                return targetPrice * count; // è¿”å›ç»„åˆç›®æ ‡å”®ä»·
            } else {
                // å¦‚æœå•å“ç›´é™æ˜¯å›ºå®šé‡‘é¢
                directDiscount = selectedComboSku.directDiscountValue;
                const targetPrice = priceAfterDirect + directDiscount;
                return targetPrice * count; // è¿”å›ç»„åˆç›®æ ‡å”®ä»·
            }
        }
        
        // æ›´æ–°ç»„åˆä¿ƒé”€åˆ†æè¡¨
        function updateComboTable(combos, singlePrice) {
            const tbody = document.getElementById('comboTableBody');
            tbody.innerHTML = '';
            
            combos.forEach(combo => {
                const originalTotal = singlePrice * combo.count;
                const finalTotal = originalTotal - combo.discount;
                const unitPrice = finalTotal / combo.count;
                const savePerUnit = singlePrice - unitPrice;
                const discountRate = (combo.discount / originalTotal) * 100;
                
                // è®¡ç®—åˆ©æ¶¦
                const cost = selectedComboSku.cost * combo.count;
                const grossProfit = finalTotal - cost;
                const grossMargin = finalTotal > 0 ? (grossProfit / finalTotal) * 100 : 0;
                
                // è®¡ç®—ç»„åˆSKUç›®æ ‡å”®ä»·ï¼ˆæ ¹æ®å•å“æŠ˜æ‰£åæ¨ï¼‰
                const comboTargetPrice = calculateComboTargetPrice(finalTotal, combo.count);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${combo.count} ç“¶</strong></td>
                    <td>${combo.discount > 0 ? combo.discount.toFixed(2) : '-'}</td>
                    <td><strong>${finalTotal.toFixed(2)}</strong></td>
                    <td><strong class="${getComboPriceClass(unitPrice, singlePrice)}">${unitPrice.toFixed(2)}</strong></td>
                    <td class="${getSaveClass(savePerUnit, singlePrice)}">${savePerUnit > 0 ? savePerUnit.toFixed(2) : '-'}</td>
                    <td class="${getDiscountRateClass(discountRate)}">${discountRate > 0 ? discountRate.toFixed(1) + '%' : '-'}</td>
                    <td class="${getProfitColor(grossProfit)}">
                        æ¯›åˆ©: ${grossProfit.toFixed(2)}<br>
                        æ¯›åˆ©ç‡: ${grossMargin.toFixed(1)}%
                    </td>
                    <td>
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <div style="font-weight: 600; color: var(--primary);">${finalTotal.toFixed(2)} å…ƒ</div>
                            <div style="font-size: 11px; color: #64748b;">æ¯ç“¶: ${unitPrice.toFixed(2)} å…ƒ</div>
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <div style="font-weight: 600; color: var(--dark);">${comboTargetPrice.toFixed(2)} å…ƒ</div>
                            <div style="font-size: 11px; color: #64748b;">æ¯ç“¶: ${(comboTargetPrice/combo.count).toFixed(2)} å…ƒ</div>
                        </div>
                    </td>
                    <td>
                        ${combo.count > 1 ? `
                        <div class="combo-sku-actions">
                            <button class="combo-sku-btn copy" data-count="${combo.count}" data-final="${finalTotal.toFixed(2)}" data-target="${comboTargetPrice.toFixed(2)}">
                                å¤åˆ¶å”®ä»·
                            </button>
                            <button class="combo-sku-btn add" data-count="${combo.count}" data-final="${finalTotal.toFixed(2)}" data-target="${comboTargetPrice.toFixed(2)}">
                                æ·»åŠ SKU
                            </button>
                        </div>
                        ` : '-'}
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // ç»‘å®šç»„åˆè¡¨æ ¼äº‹ä»¶
            bindComboTableEvents();
            
            // æ˜¾ç¤º"æ·»åŠ ç»„åˆSKU"æŒ‰é’®
            document.getElementById('addComboSKUs').style.display = 'inline-flex';
        }
        
        // ç»‘å®šç»„åˆè¡¨æ ¼äº‹ä»¶
        function bindComboTableEvents() {
            // ç»‘å®šå¤åˆ¶å”®ä»·æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.combo-sku-btn.copy').forEach(btn => {
                btn.addEventListener('click', function() {
                    const count = parseInt(this.getAttribute('data-count'));
                    const finalPrice = this.getAttribute('data-final');
                    const targetPrice = this.getAttribute('data-target');
                    
                    // å¤åˆ¶æœ€ç»ˆå”®ä»·åˆ°å‰ªè´´æ¿
                    navigator.clipboard.writeText(finalPrice).then(() => {
                        showNotification(`å·²å¤åˆ¶${count}ç“¶è£…SKUæœ€ç»ˆå”®ä»·ï¼š${finalPrice}å…ƒ`, 'success');
                    }).catch(err => {
                        // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ä¸´æ—¶textarea
                        const textArea = document.createElement('textarea');
                        textArea.value = finalPrice;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showNotification(`å·²å¤åˆ¶${count}ç“¶è£…SKUæœ€ç»ˆå”®ä»·ï¼š${finalPrice}å…ƒ`, 'success');
                    });
                });
            });
            
            // ç»‘å®šæ·»åŠ SKUæŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.combo-sku-btn.add').forEach(btn => {
                btn.addEventListener('click', function() {
                    const count = parseInt(this.getAttribute('data-count'));
                    const finalPrice = parseFloat(this.getAttribute('data-final'));
                    const targetPrice = parseFloat(this.getAttribute('data-target'));
                    addComboSKU(count, finalPrice, targetPrice);
                });
            });
        }
        
        // æ·»åŠ ç»„åˆSKUåˆ°SKUç®¡ç†
        function addComboSKU(count, finalPrice, targetPrice) {
            if (!selectedComboSku) {
                showNotification('è¯·å…ˆé€‰æ‹©SKUè¿›è¡Œåˆ†æ', 'warning');
                return;
            }
            
            if (!finalPrice || finalPrice <= 0) {
                showNotification('æœ€ç»ˆå”®ä»·æ— æ•ˆ', 'error');
                return;
            }
            
            // è®¡ç®—æˆæœ¬ï¼ˆå•ç“¶æˆæœ¬Ã—æ•°é‡ï¼‰
            const cost = selectedComboSku.cost * count;
            
            // ç”Ÿæˆæ–°SKU
            const newId = skuList.length > 0 ? Math.max(...skuList.map(sku => sku.id)) + 1 : 1;
            const newSKU = {
                id: newId,
                name: `${selectedComboSku.name} ${count}ç“¶è£…`,
                cost: cost,
                targetPrice: targetPrice, // ä½¿ç”¨åæ¨çš„ç›®æ ‡å”®ä»·
                directDiscountType: selectedComboSku.directDiscountType,
                directDiscountValue: selectedComboSku.directDiscountValue,
                couponDiscountType: selectedComboSku.couponDiscountType,
                couponDiscountValue: selectedComboSku.couponDiscountValue,
                directDiscount: 0,
                couponAmount: 0,
                finalPrice: finalPrice, // ç»„åˆSKUæœ€ç»ˆå”®ä»·
                grossProfit: finalPrice - cost,
                grossMargin: finalPrice > 0 ? ((finalPrice - cost) / finalPrice) * 100 : 0,
                costMargin: cost > 0 ? ((finalPrice - cost) / cost) * 100 : 0,
                netProfit: 0,
                netMargin: 0,
                directDiscountPreview: 0,
                couponDiscountPreview: 0,
                priceAfterDirect: 0,
                priceAfterAll: 0,
                comboDiscounts: { two: 0, three: 0, four: 0 },
                comboTargetPrices: { one: 0, two: 0, three: 0, four: 0 }
            };
            
            // è®¡ç®—æŠ˜æ‰£é¢„è§ˆ
            updateDiscountPreview(newSKU);
            
            // è®¡ç®—å®é™…æŠ˜æ‰£é‡‘é¢
            if (newSKU.targetPrice > 0) {
                // è®¡ç®—å•å“ç›´é™é‡‘é¢
                if (newSKU.directDiscountType === 'percent') {
                    newSKU.directDiscount = newSKU.targetPrice * (newSKU.directDiscountValue / 100);
                } else {
                    newSKU.directDiscount = newSKU.directDiscountValue;
                }
                
                // è®¡ç®—ä¼˜æƒ åˆ¸é‡‘é¢ï¼ˆåŸºäºå•å“ç›´é™åä»·æ ¼ï¼‰
                const priceAfterDirect = newSKU.targetPrice - newSKU.directDiscount;
                if (newSKU.couponDiscountType === 'percent') {
                    newSKU.couponAmount = priceAfterDirect * (newSKU.couponDiscountValue / 100);
                } else {
                    newSKU.couponAmount = newSKU.couponDiscountValue;
                }
            }
            
            // è®¡ç®—å‡€åˆ©æ¶¦ï¼ˆå¦‚æœæœ‰æˆæœ¬å‚æ•°ï¼‰
            const platformFeePercent = parseFloat(document.getElementById('platformFee').value) / 100 || 0;
            const kolFeePercent = parseFloat(document.getElementById('kolFee').value) / 100 || 0;
            const returnRatePercent = parseFloat(document.getElementById('returnRate').value) / 100 || 0;
            const otherCost = parseFloat(document.getElementById('otherCost').value) || 0;
            
            const platformFee = newSKU.finalPrice * platformFeePercent;
            const kolFee = newSKU.finalPrice * kolFeePercent;
            const returnLoss = newSKU.finalPrice * returnRatePercent;
            const totalOtherCosts = platformFee + kolFee + returnLoss + otherCost;
            
            newSKU.netProfit = newSKU.grossProfit - totalOtherCosts;
            newSKU.netMargin = newSKU.finalPrice > 0 ? (newSKU.netProfit / newSKU.finalPrice) * 100 : 0;
            
            skuList.push(newSKU);
            updateSKUTable();
            updateSkuSelector();
            updateReverseSkuSelector();
            
            showNotification(`å·²æ·»åŠ "${newSKU.name}"åˆ°SKUç®¡ç†ï¼Œæœ€ç»ˆå”®ä»·ï¼š${finalPrice.toFixed(2)}å…ƒï¼Œç›®æ ‡å”®ä»·ï¼š${targetPrice.toFixed(2)}å…ƒ`, 'success');
        }
        
        // æ·»åŠ æ‰€æœ‰ç»„åˆSKUåˆ°SKUç®¡ç†
        function addAllComboSKUsToManagement() {
            if (!selectedComboSku) {
                showNotification('è¯·å…ˆé€‰æ‹©SKUè¿›è¡Œåˆ†æ', 'warning');
                return;
            }
            
            // è·å–2ã€3ã€4ç“¶ç»„åˆçš„æ•°æ®
            const rows = document.querySelectorAll('#comboTableBody tr');
            if (rows.length < 4) {
                showNotification('è¯·å…ˆè®¡ç®—ç»„åˆå®šä»·', 'warning');
                return;
            }
            
            // æ·»åŠ 2ç“¶ã€3ç“¶ã€4ç“¶ç»„åˆSKU
            for (let i = 1; i <= 3; i++) {
                const row = rows[i];
                const count = i + 1; // 2, 3, 4
                const finalPriceCell = row.cells[7];
                const targetPriceCell = row.cells[8];
                
                if (finalPriceCell && targetPriceCell) {
                    const finalPriceText = finalPriceCell.querySelector('div:first-child').textContent;
                    const targetPriceText = targetPriceCell.querySelector('div:first-child').textContent;
                    
                    const finalPrice = parseFloat(finalPriceText.replace('å…ƒ', '').trim());
                    const targetPrice = parseFloat(targetPriceText.replace('å…ƒ', '').trim());
                    
                    if (finalPrice && finalPrice > 0 && targetPrice && targetPrice > 0) {
                        addComboSKU(count, finalPrice, targetPrice);
                    }
                }
            }
        }
        
        // å¤åˆ¶æ‰€æœ‰ç»„åˆSKUåˆ°SKUç®¡ç†
        function copyAllComboSKUsToManagement() {
            addAllComboSKUsToManagement();
        }
        
        // è·å–ç»„åˆä»·æ ¼é¢œè‰²ç±»
        function getComboPriceClass(unitPrice, singlePrice) {
            const discount = ((singlePrice - unitPrice) / singlePrice) * 100;
            if (discount > 20) return 'discount-high';
            if (discount > 10) return 'discount-medium';
            if (discount > 0) return 'discount-low';
            return '';
        }
        
        // è·å–èŠ‚çœé‡‘é¢é¢œè‰²ç±»
        function getSaveClass(saveAmount, singlePrice) {
            const saveRate = (saveAmount / singlePrice) * 100;
            if (saveRate > 15) return 'save-high';
            if (saveRate > 8) return 'save-medium';
            if (saveRate > 0) return 'save-low';
            return '';
        }
        
        // è·å–æŠ˜æ‰£ç‡é¢œè‰²ç±»
        function getDiscountRateClass(discountRate) {
            if (discountRate > 20) return 'discount-rate-high';
            if (discountRate > 10) return 'discount-rate-medium';
            if (discountRate > 0) return 'discount-rate-low';
            return '';
        }
        
        // åŠ è½½ç»„åˆè®¾ç½®
        function loadComboSettings(skuId) {
            const sku = skuList.find(s => s.id === skuId);
            if (!sku) return;
            
            // åŠ è½½ç»„åˆä¼˜æƒ 
            if (sku.comboDiscounts) {
                document.getElementById('twoComboDiscount').value = sku.comboDiscounts.two || 0;
                document.getElementById('threeComboDiscount').value = sku.comboDiscounts.three || 0;
                document.getElementById('fourComboDiscount').value = sku.comboDiscounts.four || 0;
            }
            
            // åŠ è½½ç›®æ ‡å”®ä»·ï¼ˆå¦‚æœæœ‰ï¼‰
            if (sku.comboTargetPrices) {
                // ç›®æ ‡å”®ä»·ä¼šåœ¨è¡¨æ ¼ä¸­æ˜¾ç¤ºï¼Œè¿™é‡Œä¸éœ€è¦å•ç‹¬è®¾ç½®
            }
        }
        
        // é‡ç½®ç»„åˆè®¾ç½®
        function resetComboSettings() {
            document.getElementById('twoComboDiscount').value = '';
            document.getElementById('threeComboDiscount').value = '';
            document.getElementById('fourComboDiscount').value = '';
            
            // é‡ç½®ç›®æ ‡å”®ä»·
            if (selectedComboSku) {
                selectedComboSku.comboTargetPrices = {
                    one: 0,
                    two: 0,
                    three: 0,
                    four: 0
                };
            }
        }
        
        // æ¸…ç©ºç»„åˆè®¾ç½®
        function clearComboSettings() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç»„åˆä¿ƒé”€è®¾ç½®å—ï¼Ÿ')) {
                resetComboSettings();
                document.getElementById('comboSkuSelect').value = '';
                selectedComboSku = null;
                
                // é‡ç½®æ˜¾ç¤º
                const combos = [1, 2, 3, 4];
                combos.forEach(count => {
                    const prefix = count === 1 ? 'single' : count === 2 ? 'two' : count === 3 ? 'three' : 'four';
                    document.getElementById(`${prefix}Price`).textContent = '- å…ƒ';
                    document.getElementById(`${prefix}UnitPrice`).textContent = 'æ¯ç“¶ï¼š- å…ƒ';
                    if (count > 1) {
                        document.getElementById(`${prefix}SavePerUnit`).textContent = '-';
                        document.getElementById(`${prefix}SavePerUnit`).className = 'discount-value';
                    } else {
                        document.getElementById('singleDiscount').textContent = '-';
                    }
                });
                
                // æ¸…ç©ºè¡¨æ ¼
                document.getElementById('comboTableBody').innerHTML = `
                    <tr>
                        <td colspan="10" class="placeholder" style="text-align: center;">è¯·é€‰æ‹©SKUå¹¶è®¾ç½®ç»„åˆä¼˜æƒ </td>
                    </tr>
                `;
                
                // éšè—"æ·»åŠ ç»„åˆSKU"æŒ‰é’®
                document.getElementById('addComboSKUs').style.display = 'none';
                
                showNotification('ç»„åˆä¿ƒé”€è®¾ç½®å·²æ¸…ç©º', 'success');
            }
        }
        
        // ä¿å­˜ç»„åˆæ–¹æ¡ˆ
        function saveComboScheme() {
            if (!selectedComboSku) {
                showNotification('è¯·å…ˆé€‰æ‹©å¹¶åˆ†æä¸€ä¸ªSKU', 'warning');
                return;
            }
            
            // ä¿å­˜åˆ°comboData
            comboData[selectedComboSku.id] = {
                skuName: selectedComboSku.name,
                singlePrice: selectedComboSku.finalPrice,
                comboDiscounts: {
                    two: parseFloat(document.getElementById('twoComboDiscount').value) || 0,
                    three: parseFloat(document.getElementById('threeComboDiscount').value) || 0,
                    four: parseFloat(document.getElementById('fourComboDiscount').value) || 0
                },
                comboTargetPrices: selectedComboSku.comboTargetPrices || {
                    one: 0,
                    two: 0,
                    three: 0,
                    four: 0
                },
                savedAt: new Date().toLocaleString()
            };
            
            // ä¹Ÿä¿å­˜åˆ°SKUå¯¹è±¡ä¸­
            selectedComboSku.comboDiscounts = comboData[selectedComboSku.id].comboDiscounts;
            selectedComboSku.comboTargetPrices = comboData[selectedComboSku.id].comboTargetPrices;
            
            showNotification(`"${selectedComboSku.name}"çš„ç»„åˆä¿ƒé”€æ–¹æ¡ˆå·²ä¿å­˜`, 'success');
        }
        
        // å¯¼å‡ºç»„åˆåˆ†æ
        function exportComboAnalysis() {
            if (!selectedComboSku) {
                showNotification('è¯·å…ˆé€‰æ‹©å¹¶åˆ†æä¸€ä¸ªSKU', 'warning');
                return;
            }
            
            const exportData = {
                å¯¼å‡ºæ—¶é—´: new Date().toLocaleString(),
                SKUä¿¡æ¯: {
                    åç§°: selectedComboSku.name,
                    æˆæœ¬ä»·: selectedComboSku.cost.toFixed(2) + 'å…ƒ',
                    å•ä¹°ä»·æ ¼: selectedComboSku.finalPrice.toFixed(2) + 'å…ƒ',
                    å•ä¹°æ¯›åˆ©ç‡: selectedComboSku.grossMargin.toFixed(1) + '%',
                    å•ä¹°æˆæœ¬æ¯›åˆ©ç‡: selectedComboSku.costMargin.toFixed(1) + '%'
                },
                ç»„åˆä¿ƒé”€è®¾ç½®: {
                    ä¸¤ç“¶ç»„åˆä¼˜æƒ : document.getElementById('twoComboDiscount').value + 'å…ƒ',
                    ä¸‰ç“¶ç»„åˆä¼˜æƒ : document.getElementById('threeComboDiscount').value + 'å…ƒ',
                    å››ç“¶ç»„åˆä¼˜æƒ : document.getElementById('fourComboDiscount').value + 'å…ƒ'
                },
                ç»„åˆä¿ƒé”€åˆ†æ: []
            };
            
            // è®¡ç®—å„ç§ç»„åˆ
            const combos = [
                { count: 1, label: 'å•ä¹°', discount: 0 },
                { count: 2, label: '2ç“¶ç»„åˆ', discount: parseFloat(document.getElementById('twoComboDiscount').value) || 0 },
                { count: 3, label: '3ç“¶ç»„åˆ', discount: parseFloat(document.getElementById('threeComboDiscount').value) || 0 },
                { count: 4, label: '4ç“¶ç»„åˆ', discount: parseFloat(document.getElementById('fourComboDiscount').value) || 0 }
            ];
            
            combos.forEach(combo => {
                const originalTotal = selectedComboSku.finalPrice * combo.count;
                const finalTotal = originalTotal - combo.discount;
                const unitPrice = finalTotal / combo.count;
                const savePerUnit = selectedComboSku.finalPrice - unitPrice;
                const discountRate = (combo.discount / originalTotal) * 100;
                
                // è®¡ç®—åˆ©æ¶¦
                const cost = selectedComboSku.cost * combo.count;
                const grossProfit = finalTotal - cost;
                const grossMargin = finalTotal > 0 ? (grossProfit / finalTotal) * 100 : 0;
                
                // è®¡ç®—ç»„åˆSKUç›®æ ‡å”®ä»·ï¼ˆæ ¹æ®å•å“æŠ˜æ‰£åæ¨ï¼‰
                const comboTargetPrice = calculateComboTargetPrice(finalTotal, combo.count);
                
                exportData.ç»„åˆä¿ƒé”€åˆ†æ.push({
                    è´­ä¹°æ•°é‡: `${combo.count}ç“¶`,
                    ç»„åˆä¼˜æƒ : combo.discount.toFixed(2) + 'å…ƒ',
                    å®ä»˜æ€»ä»·: finalTotal.toFixed(2) + 'å…ƒ',
                    æ¯ç“¶ä»·æ ¼: unitPrice.toFixed(2) + 'å…ƒ',
                    æ¯ç“¶èŠ‚çœ: savePerUnit > 0 ? savePerUnit.toFixed(2) + 'å…ƒ' : '0å…ƒ',
                    æŠ˜æ‰£å¹…åº¦: discountRate > 0 ? discountRate.toFixed(1) + '%' : '0%',
                    æ€»æ¯›åˆ©: grossProfit.toFixed(2) + 'å…ƒ',
                    æ¯›åˆ©ç‡: grossMargin.toFixed(1) + '%',
                    ç»„åˆSKUæœ€ç»ˆå”®ä»·: finalTotal.toFixed(2) + 'å…ƒ',
                    ç»„åˆSKUç›®æ ‡å”®ä»·: comboTargetPrice.toFixed(2) + 'å…ƒ',
                    ç»„åˆSKUæ¯ç“¶å”®ä»·: (comboTargetPrice/combo.count).toFixed(2) + 'å…ƒ'
                });
            });
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ç»„åˆä¿ƒé”€åˆ†æ_${selectedComboSku.name}_${new Date().getTime()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showNotification('ç»„åˆä¿ƒé”€åˆ†ææ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶', 'success');
        }
        
        // åº”ç”¨åˆ°æ‰€æœ‰SKU
        function applyToAllSKUs() {
            showNotification('æˆæœ¬å‚æ•°å·²åº”ç”¨åˆ°æ‰€æœ‰SKUçš„è®¡ç®—ä¸­', 'success');
        }
        
        // é‡ç½®é…ç½®
        function resetConfig() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æˆæœ¬å‚æ•°å—ï¼Ÿ')) {
                // é‡ç½®æˆæœ¬å‚æ•°ä¸ºé»˜è®¤å€¼
                document.getElementById('platformFee').value = 5;
                document.getElementById('kolFee').value = 20;
                document.getElementById('returnRate').value = 5;
                document.getElementById('otherCost').value = 5;
                
                // æ›´æ–°æˆæœ¬é¢„è§ˆ
                updateCostPreview();
                
                showNotification('æˆæœ¬å‚æ•°å·²é‡ç½®ä¸ºé»˜è®¤å€¼', 'success');
            }
        }
        
        // å¯¼å‡ºSKUæ•°æ®
        function exportSKUData() {
            if (skuList.length === 0) {
                showNotification('æ²¡æœ‰SKUæ•°æ®å¯ä»¥å¯¼å‡º', 'error');
                return;
            }
            
            const validSKUs = skuList.filter(sku => sku.finalPrice > 0 && sku.cost > 0);
            
            if (validSKUs.length === 0) {
                showNotification('æ²¡æœ‰å·²è®¡ç®—çš„SKUæ•°æ®å¯ä»¥å¯¼å‡º', 'warning');
                return;
            }
            
            const exportData = {
                å¯¼å‡ºæ—¶é—´: new Date().toLocaleString(),
                SKUæ€»æ•°: skuList.length,
                å·²è®¡ç®—SKUæ•°: validSKUs.length,
                æˆæœ¬å‚æ•°: {
                    å¹³å°ä½£é‡‘æ¯”ä¾‹: document.getElementById('platformFee').value || '0' + '%',
                    è¾¾äººä½£é‡‘æ¯”ä¾‹: document.getElementById('kolFee').value || '0' + '%',
                    é€€è´§ç‡é¢„ä¼°: document.getElementById('returnRate').value || '0' + '%',
                    å…¶ä»–æˆæœ¬: document.getElementById('otherCost').value || '0' + 'å…ƒ'
                },
                SKUåˆ—è¡¨: validSKUs.map(sku => ({
                    SKUåç§°: sku.name,
                    å®é™…æˆæœ¬: sku.cost.toFixed(2) + 'å…ƒ',
                    ç›®æ ‡å”®ä»·: sku.targetPrice.toFixed(2) + 'å…ƒ',
                    å•å“ç›´é™ç±»å‹: sku.directDiscountType === 'percent' ? 'ç™¾åˆ†æ¯”' : 'å›ºå®šé‡‘é¢',
                    å•å“ç›´é™å€¼: sku.directDiscountValue + (sku.directDiscountType === 'percent' ? '%' : 'å…ƒ'),
                    å•å“ç›´é™é‡‘é¢: sku.directDiscount.toFixed(2) + 'å…ƒ',
                    ä¼˜æƒ åˆ¸ç±»å‹: sku.couponDiscountType === 'percent' ? 'ç™¾åˆ†æ¯”' : 'å›ºå®šé‡‘é¢',
                    ä¼˜æƒ åˆ¸å€¼: sku.couponDiscountValue + (sku.couponDiscountType === 'percent' ? '%' : 'å…ƒ'),
                    ä¼˜æƒ åˆ¸é‡‘é¢: sku.couponAmount.toFixed(2) + 'å…ƒ',
                    æœ€ç»ˆå”®ä»·: sku.finalPrice.toFixed(2) + 'å…ƒ',
                    æ¯›åˆ©: sku.grossProfit.toFixed(2) + 'å…ƒ',
                    æ¯›åˆ©ç‡: sku.grossMargin.toFixed(1) + '%',
                    æˆæœ¬æ¯›åˆ©ç‡: sku.costMargin.toFixed(1) + '%',
                    å‡€åˆ©: sku.netProfit.toFixed(2) + 'å…ƒ',
                    å‡€åˆ©ç‡: sku.netMargin.toFixed(1) + '%',
                    ç»„åˆä¿ƒé”€: sku.comboDiscounts ? {
                        ä¸¤ç“¶ç»„åˆä¼˜æƒ : sku.comboDiscounts.two.toFixed(2) + 'å…ƒ',
                        ä¸‰ç“¶ç»„åˆä¼˜æƒ : sku.comboDiscounts.three.toFixed(2) + 'å…ƒ',
                        å››ç“¶ç»„åˆä¼˜æƒ : sku.comboDiscounts.four.toFixed(2) + 'å…ƒ'
                    } : 'æœªè®¾ç½®',
                    ç»„åˆç›®æ ‡å”®ä»·: sku.comboTargetPrices ? {
                        å•ä¹°ç›®æ ‡å”®ä»·: sku.comboTargetPrices.one.toFixed(2) + 'å…ƒ',
                        ä¸¤ç“¶ç›®æ ‡å”®ä»·: sku.comboTargetPrices.two.toFixed(2) + 'å…ƒ',
                        ä¸‰ç“¶ç›®æ ‡å”®ä»·: sku.comboTargetPrices.three.toFixed(2) + 'å…ƒ',
                        å››ç“¶ç›®æ ‡å”®ä»·: sku.comboTargetPrices.four.toFixed(2) + 'å…ƒ'
                    } : 'æœªè®¾ç½®'
                }))
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `SKUå®šä»·åˆ†æ_${new Date().getTime()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showNotification('SKUæ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶', 'success');
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    </script>
    
    <style>
        /* åˆ©æ¶¦é¢œè‰²æ ·å¼ */
        .profit-high {
            color: var(--success);
            font-weight: 700;
        }
        
        .profit-medium {
            color: var(--warning);
            font-weight: 700;
        }
        
        .profit-low {
            color: #f59e0b;
            font-weight: 700;
        }
        
        .profit-very-low {
            color: #f97316;
            font-weight: 700;
        }
        
        .profit-negative {
            color: var(--danger);
            font-weight: 700;
        }
        
        .profit-positive {
            color: var(--primary);
            font-weight: 600;
        }
        
        /* è¡¨æ ¼ä¸­çš„åˆ©æ¶¦é¢œè‰² */
        .sku-gross-profit.profit-high,
        .sku-net-profit.profit-high {
            color: var(--success);
            font-weight: 600;
        }
        
        .sku-gross-profit.profit-medium,
        .sku-net-profit.profit-medium {
            color: var(--warning);
            font-weight: 600;
        }
        
        .sku-gross-profit.profit-low,
        .sku-net-profit.profit-low {
            color: #f59e0b;
            font-weight: 600;
        }
        
        .sku-gross-profit.profit-very-low,
        .sku-net-profit.profit-very-low {
            color: #f97316;
            font-weight: 600;
        }
        
        .sku-gross-profit.profit-negative,
        .sku-net-profit.profit-negative {
            color: var(--danger);
            font-weight: 600;
        }
        
        .sku-gross-margin.profit-high,
        .sku-net-margin.profit-high {
            color: var(--success);
            font-weight: 600;
        }
        
        .sku-gross-margin.profit-medium,
        .sku-net-margin.profit-medium {
            color: var(--warning);
            font-weight: 600;
        }
        
        .sku-gross-margin.profit-low,
        .sku-net-margin.profit-low {
            color: #f59e0b;
            font-weight: 600;
        }
        
        .sku-gross-margin.profit-very-low,
        .sku-net-margin.profit-very-low {
            color: #f97316;
            font-weight: 600;
        }
        
        .sku-gross-margin.profit-negative,
        .sku-net-margin.profit-negative {
            color: var(--danger);
            font-weight: 600;
        }
        
        .sku-cost-margin.profit-high {
            color: #8b5cf6;
            font-weight: 600;
        }
        
        .sku-cost-margin.profit-medium {
            color: var(--success);
            font-weight: 600;
        }
        
        .sku-cost-margin.profit-low {
            color: var(--warning);
            font-weight: 600;
        }
        
        .sku-cost-margin.profit-very-low {
            color: #f97316;
            font-weight: 600;
        }
        
        .sku-cost-margin.profit-negative {
            color: var(--danger);
            font-weight: 600;
        }
        
        .sku-final-price.profit-positive {
            color: var(--primary);
            font-weight: 600;
        }
        
        /* ç»„åˆä¿ƒé”€è¡¨æ ¼é¢œè‰² */
        .discount-high {
            color: var(--danger);
            font-weight: 600;
        }
        
        .discount-medium {
            color: var(--warning);
            font-weight: 600;
        }
        
        .discount-low {
            color: var(--primary);
            font-weight: 600;
        }
        
        .save-high {
            color: var(--danger);
            font-weight: 600;
        }
        
        .save-medium {
            color: var(--warning);
            font-weight: 600;
        }
        
        .save-low {
            color: var(--success);
            font-weight: 600;
        }
        
        .discount-rate-high {
            color: var(--danger);
            font-weight: 600;
        }
        
        .discount-rate-medium {
            color: var(--warning);
            font-weight: 600;
        }
        
        .discount-rate-low {
            color: var(--primary);
            font-weight: 600;
        }
        
        /* ç»„åˆä¿ƒé”€å¡ç‰‡åˆ©æ¶¦é¢œè‰² */
        .discount-value.danger {
            color: var(--danger);
        }
        
        .discount-value.warning {
            color: var(--warning);
        }
        
        .discount-value.success {
            color: var(--success);
        }
        
        .discount-value.primary {
            color: var(--primary);
        }
    </style>
</body>
</html>
